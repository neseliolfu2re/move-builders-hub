<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Move Builders Hub ‚Ä¢ On-Chain Move Learning</title>
	<meta name="color-scheme" content="dark light" />
	<!-- PWA Meta Tags -->
	<meta name="theme-color" content="#82ffa1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-title" content="Move Builders Hub">
	<link rel="manifest" href="manifest.json">
	<link rel="apple-touch-icon" href="logo.png">
	<style>
		:root { color-scheme: dark; }
		html, body { height: 100%; }
		* { box-sizing: border-box; }
		body {
			margin: 0;
			font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
			background: #000;
			color: #fff;
		}
		.container { width: min(1200px, 92vw); margin: 0 auto; padding: 20px; }
		.header { display: grid; gap: 12px; text-align: center; padding: 40px 0 24px; }
		h1 { font-size: clamp(28px, 4vw, 40px); margin: 0; }
		.subtitle { color: #bdbdbd; margin: 0 auto; max-width: 800px; }
		.badges { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 8px; }
		.badge { padding: 6px 12px; border-radius: 999px; border: 1px solid #2a2a2a; background:#0f0f0f; font-size: 12px; color:#e5e5e5; }
		.ctaRow { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top: 14px; }
		.btn { appearance:none; border:1px solid #fff; background:#fff; color:#000; padding:12px 16px; border-radius:10px; font-weight:600; cursor:pointer; }
		.btn.secondary { background:transparent; color:#fff; border-color:#fff; }
		.note { color:#ffd788; font-size: 12px; margin-top: 6px; }
		.divider { height:1px; background:#1f1f1f; margin: 24px 0; }

		.grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); }
		.card { background:#0f0f0f; border:1px solid #222; border-radius:14px; padding:18px; }
		.card h3 { margin:0 0 8px 0; font-size:18px; }
		.card p { margin:0; color:#cfcfcf; line-height:1.5; }

		.sectionTitle { font-size:20px; margin: 0 0 12px 0; }
		.row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
		.kpi { text-align:center; padding:14px; border:1px solid #222; border-radius:12px; background:#0f0f0f; }
		.kpi .num { font-size:20px; font-weight:700; }
		.kpi .lbl { color:#bdbdbd; font-size:12px; }

		.footer { text-align:center; color:#8a8a8a; font-size:12px; padding: 24px 0 40px; }
		.footer a:hover { color: #82ffa1; transition: color 0.2s ease; }

		/* Modal */
		.modalBack { position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; place-items:center; z-index:1000; }
		.modal { width:min(860px,94vw); max-height:80vh; overflow:auto; background:#0f0f0f; border:1px solid #2a2a2a; border-radius:16px; padding:20px; }
		.modal h2 { margin:0 0 10px 0; font-size:20px; }
		.modal .qgrid { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); margin-top: 8px; }
		.qcard { border:1px solid #222; border-radius:12px; padding:12px; background:#111; }
		.qtop { display:flex; align-items:center; justify-content:space-between; gap:8px; }
		.qdiff { font-size:12px; padding:4px 8px; border:1px solid #333; border-radius:999px; color:#e5e5e5; }
		.qdesc { color:#cfcfcf; font-size:14px; margin:10px 0; line-height:1.5; }
		.qrow { display:flex; align-items:center; justify-content:space-between; }
		.qreward { color:#82ffa1; font-weight:700; }
		.linkish { color:#fff; text-decoration:none; }

		/* Profile chips */
		.chips { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
		.chip { font-size:12px; padding:4px 8px; border:1px solid #333; border-radius:999px; color:#e5e5e5; }

		/* Loading spinner */
		.spinner { width:16px; height:16px; border:2px solid #333; border-top:2px solid #82ffa1; border-radius:50%; animation:spin 1s linear infinite; display:inline-block; margin-right:8px; }
		@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
		.btn.loading { opacity:0.7; cursor:not-allowed; }

		/* Force 3-3 layout on desktop and center */
		@media (min-width: 900px) {
			.grid { grid-template-columns: repeat(3, 1fr); justify-items: stretch; }
		}
	</style>
</head>
<body>
	<!-- Top Navigation with Wallet -->
	<nav style="position: fixed; top: 0; right: 0; z-index: 1000; padding: 16px;">
		<button class="btn" id="connectWallet" style="display:none; font-size:12px; padding:8px 12px;">Connect Wallet</button>
		<div id="walletInfo" style="display:none; background:#0f0f0f; border:1px solid #2a2a2a; border-radius:8px; padding:8px; text-align:center;">
			<div style="color:#82ffa1; font-size:11px; margin-bottom:4px;">üü¢ Connected</div>
			<div id="walletAddress" style="font-family:monospace; font-size:10px; color:#cfcfcf; margin-bottom:6px;"></div>
			<button class="btn secondary" id="disconnectWallet" style="font-size:10px; padding:4px 8px;">Disconnect</button>
		</div>
	</nav>

	<!-- Logo Section -->
	<div class="container" style="text-align: center; padding: 20px 20px 10px;">
		<img src="logo.png" alt="Move Builders Hub" style="width: 160px; height: auto; max-width: 100%; margin-bottom: -8px;">
	</div>

	<header class="container header">
		<h1>Move Builders Hub ‚Ä¢ On-Chain Move Learning</h1>
		<p class="subtitle">A collaboration-first platform that tracks Move learning on-chain with quests, mentorship, collaboration sessions, sponsor rewards, and analytics.</p>
		<div class="badges">
			<span class="badge">Aptos Testnet</span>
			<span class="badge">Move Language</span>
			<span class="badge">On-Chain Proof</span>
			<span class="badge">Mentorship</span>
			<span class="badge">Collaboration</span>
			<span class="badge">Sponsors & Rewards</span>
		</div>
		<div class="ctaRow">
			<button class="btn" id="exploreQuests">Explore Quests</button>
			<button class="btn secondary" id="viewStats">View Analytics</button>
			<button class="btn secondary" id="myDashboard" style="display:none;">My Dashboard</button>
		</div>
		<!-- Referral Section (moved to bottom) -->
		<div id="referralSection" style="display:none; margin-top:12px;">
			<button class="btn secondary" id="getReferralLink" style="font-size:12px;">üîó Get Referral Link</button>
		</div>
	</header>

	<main class="container">
		<section>
			<h2 class="sectionTitle">Highlights</h2>
			<div class="grid">
				<div class="card" onclick="scrollToQuests()" style="cursor:pointer; transition:all 0.2s ease;" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#222'">
					<h3>üéØ Quest System</h3>
					<p>Practice with leveled Move quests and record progress on-chain.</p>
					<div style="position:absolute; top:18px; right:18px; color:#82ffa1;">‚Üí</div>
				</div>
				<div class="card" onclick="scrollToMentorship()" style="cursor:pointer; transition:all 0.2s ease;" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#222'">
					<h3>üë• Mentorship</h3>
					<p>Match with experienced Move devs, schedule 1:1 sessions, grow faster.</p>
					<div style="position:absolute; top:18px; right:18px; color:#82ffa1;">‚Üí</div>
				</div>
				<div class="card" onclick="scrollToCollaboration()" style="cursor:pointer; transition:all 0.2s ease;" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#222'">
					<h3>ü§ù Collaboration</h3>
					<p>Pair-program and join mini-hackathons to solve real problems together.</p>
					<div style="position:absolute; top:18px; right:18px; color:#82ffa1;">‚Üí</div>
				</div>
				<div class="card" onclick="scrollToRewards()" style="cursor:pointer; transition:all 0.2s ease;" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#222'">
					<h3>üèÜ Rewards & Sponsors</h3>
					<p>Complete sponsor quests and earn rewards. Sustainable, tokenless model.</p>
					<div style="position:absolute; top:18px; right:18px; color:#82ffa1;">‚Üí</div>
				</div>
				<div class="card" onclick="scrollToAnalytics()" style="cursor:pointer; transition:all 0.2s ease;" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#222'">
					<h3>üìä Analytics</h3>
					<p>DAU, quest completion rate, and average difficulty over time.</p>
					<div style="position:absolute; top:18px; right:18px; color:#82ffa1;">‚Üí</div>
				</div>
				<div class="card" onclick="scrollToProfiles()" style="cursor:pointer; transition:all 0.2s ease;" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#222'">
					<h3>üîê Builder Profiles</h3>
					<p>Meet experienced Move developers and view their achievements.</p>
					<div style="position:absolute; top:18px; right:18px; color:#82ffa1;">‚Üí</div>
				</div>
			</div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Builder Profiles</h2>
			<div class="grid" id="profilesGrid"></div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Live Analytics Dashboard</h2>
			<div class="grid">
				<div class="kpi"><div class="num" id="activeDevelopers">127</div><div class="lbl">Active Developers</div></div>
				<div class="kpi"><div class="num" id="completedQuests">89</div><div class="lbl">Completed Quests</div></div>
				<div class="kpi"><div class="num" id="onChainTx">156</div><div class="lbl">On-Chain Transactions</div></div>
			</div>
			
			<div style="display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); margin-top:16px;">
				<div style="background:#0f0f0f; border:1px solid #222; border-radius:12px; padding:16px;">
					<h3 style="margin:0 0 12px 0;">Quest Completion Trend</h3>
					<canvas id="questChart" width="300" height="120"></canvas>
				</div>
				<div style="background:#0f0f0f; border:1px solid #222; border-radius:12px; padding:16px;">
					<h3 style="margin:0 0 12px 0;">Top Builders</h3>
					<div id="topBuilders">
						<div style="display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid #2a2a2a;">
							<span>@nese</span><span style="color:#82ffa1;">35 quests</span>
						</div>
						<div style="display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid #2a2a2a;">
							<span>@dilek</span><span style="color:#82ffa1;">29 quests</span>
						</div>
						<div style="display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid #2a2a2a;">
							<span>@selina</span><span style="color:#82ffa1;">22 quests</span>
						</div>
						<div style="display:flex; justify-content:space-between; padding:6px 0;">
							<span>@deniz</span><span style="color:#82ffa1;">20 quests</span>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Mentorship & Collaboration</h2>
			<div class="grid">
				<div class="card">
					<h3>Schedule Mentorship</h3>
					<p>Create your profile and goals, match with mentors via calendar.</p>
					<button class="btn" id="findMentorBtn">Find Mentor</button>
				</div>
				<div class="card">
					<h3>Pair Programming</h3>
					<p>Team up on specific quests, exchange knowledge and code together.</p>
					<button class="btn secondary" id="joinPairBtn">Join Session</button>
				</div>
				<div class="card">
					<h3>Mini-Hackathons</h3>
					<p>Sponsor-supported, time-boxed events for focused building.</p>
					<button class="btn" id="viewHackathonsBtn">View Events</button>
				</div>
			</div>
			
			<!-- Active Collaborations -->
			<div style="margin-top:20px;">
				<h3>üî• Active Collaborations</h3>
				<div class="grid">
					<div class="card">
						<h4>DeFi Protocol Build</h4>
						<p>Building a lending protocol in Move. <strong>3/5 spots filled</strong></p>
						<div class="chips" style="margin-bottom:12px;">
							<span class="chip">Advanced</span>
							<span class="chip">2 weeks</span>
							<span class="chip">Reward: 5 APT</span>
						</div>
						<button class="btn" onclick="joinCollaboration('defi-protocol')" style="width:100%;">Join Team</button>
					</div>
					<div class="card">
						<h4>NFT Marketplace</h4>
						<p>Creating an NFT trading platform. <strong>2/4 spots filled</strong></p>
						<div class="chips" style="margin-bottom:12px;">
							<span class="chip">Intermediate</span>
							<span class="chip">3 weeks</span>
							<span class="chip">Reward: 3 APT</span>
						</div>
						<button class="btn" onclick="joinCollaboration('nft-marketplace')" style="width:100%;">Join Team</button>
					</div>
					<div class="card">
						<h4>Move Learning Game</h4>
						<p>Gamified Move education platform. <strong>1/3 spots filled</strong></p>
						<div class="chips" style="margin-bottom:12px;">
							<span class="chip">Beginner</span>
							<span class="chip">1 week</span>
							<span class="chip">Reward: 1 APT</span>
						</div>
						<button class="btn" onclick="joinCollaboration('learning-game')" style="width:100%;">Join Team</button>
					</div>
				</div>
			</div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Rewards & Sponsors</h2>
			<div class="grid">
				<div class="card">
					<h3>Sponsor Pools</h3>
					<p>Sponsors open themed pools; complete quests and earn points.</p>
					<button class="btn" id="viewSponsorPools">View Active Pools</button>
				</div>
				<div class="card">
					<h3>Fair Evaluation</h3>
					<p>Collaboration over competition. No exploit-chasing mechanics.</p>
					<button class="btn secondary" id="leaderboardBtn">View Leaderboard</button>
				</div>
				<div class="card">
					<h3>Transparency</h3>
					<p>On-chain records make progress and rewards verifiable.</p>
					<button class="btn secondary" id="verifyRewards">Verify My Rewards</button>
				</div>
			</div>
			
			<!-- Active Sponsor Pools -->
			<div style="margin-top:20px;">
				<h3>üí∞ Active Sponsor Pools</h3>
				<div class="grid">
					<div class="card">
						<h4>üè¶ Aptos Foundation Pool</h4>
						<p>Focus on core Move development and education</p>
						<div class="chips">
							<span class="chip">Pool: 1000 APT</span>
							<span class="chip">127 Participants</span>
							<span class="chip">Ends: Dec 31</span>
						</div>
						<div style="background:#1a1a1a; height:6px; border-radius:3px; margin:8px 0;">
							<div style="background:#82ffa1; height:100%; width:65%; border-radius:3px;"></div>
						</div>
						<small style="display:block; margin-bottom:12px;">65% distributed</small>
						<button class="btn" onclick="joinSponsorPool('aptos-foundation')" style="width:100%;">Join Pool</button>
					</div>
					<div class="card">
						<h4>üîä Decibel Pool</h4>
						<p>Infrastructure and developer tooling focus</p>
						<div class="chips">
							<span class="chip">Pool: 750 APT</span>
							<span class="chip">92 Participants</span>
							<span class="chip">Ends: Nov 30</span>
						</div>
						<div style="background:#1a1a1a; height:6px; border-radius:3px; margin:8px 0;">
							<div style="background:#82ffa1; height:100%; width:45%; border-radius:3px;"></div>
						</div>
						<small style="display:block; margin-bottom:12px;">45% distributed</small>
						<button class="btn" onclick="joinSponsorPool('decibel')" style="width:100%;">Join Pool</button>
					</div>
					<div class="card">
						<h4>‚ö° Shelby Protocol Pool</h4>
						<p>Cross-chain and interoperability solutions</p>
						<div class="chips" style="margin-bottom:8px;">
							<span class="chip">Pool: 400 APT</span>
							<span class="chip">67 Participants</span>
							<span class="chip">Ends: Jan 15</span>
						</div>
						<div style="background:#1a1a1a; height:6px; border-radius:3px; margin:8px 0;">
							<div style="background:#82ffa1; height:100%; width:30%; border-radius:3px;"></div>
						</div>
						<small style="display:block; margin-bottom:12px;">30% distributed</small>
						<button class="btn" onclick="joinSponsorPool('shelby-protocol')" style="width:100%;">Join Pool</button>
					</div>
				</div>
			</div>
		</section>
	</main>

	<footer class="footer container">
		<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; margin-bottom: 20px; text-align: left;">
			<div>
				<h4 style="color: #fff; margin: 0 0 12px 0; font-size: 14px;">Aptos Labs</h4>
				<div style="display: flex; flex-direction: column; gap: 6px;">
					<a href="https://aptoslabs.com" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">Website</a>
					<a href="https://github.com/aptos-labs" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">GitHub</a>
				</div>
			</div>
			<div>
				<h4 style="color: #fff; margin: 0 0 12px 0; font-size: 14px;">Aptos Foundation</h4>
				<div style="display: flex; flex-direction: column; gap: 6px;">
					<a href="https://aptosfoundation.org" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">Website</a>
				</div>
			</div>
			<div>
				<h4 style="color: #fff; margin: 0 0 12px 0; font-size: 14px;">Developer Resources</h4>
				<div style="display: flex; flex-direction: column; gap: 6px;">
					<a href="https://aptos.dev" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">Documentation</a>
					<a href="https://aptos.dev/move" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">Move Language</a>
					<a href="https://aptos.dev/sdks" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">SDK & Tools</a>
					<a href="https://aptos.dev/rest-api" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">API Reference</a>
				</div>
			</div>
			<div>
				<h4 style="color: #fff; margin: 0 0 12px 0; font-size: 14px;">Explorer & Faucet</h4>
				<div style="display: flex; flex-direction: column; gap: 6px;">
					<a href="https://explorer.aptoslabs.com" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">Block Explorer</a>
					<a href="https://faucet.aptoslabs.com" target="_blank" style="color: #8a8a8a; text-decoration: none; font-size: 12px;">Testnet Faucet</a>
				</div>
			</div>
		</div>
		<div style="text-align: center; padding-top: 16px; border-top: 1px solid #2a2a2a;">
			Move Builders Hub ‚Ä¢ Aptos Testnet ‚Ä¢ ¬© 2025
		</div>
	</footer>

	<!-- Quests Modal -->
	<div id="questsModal" class="modalBack">
		<div class="modal">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üöÄ Available Move Quests</h2>
				<a class="linkish" href="#" id="closeModal">Close ‚úï</a>
			</div>
			<p class="subtitle">Interactive Move learning quests with on-chain completion tracking.</p>
			<div class="qgrid" id="qgrid"></div>
		</div>
	</div>

	<!-- Profile Modal -->
	<div id="profileModal" class="modalBack">
		<div class="modal">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2 id="pm_name">Builder Profile</h2>
				<a class="linkish" href="#" id="pm_close">Close ‚úï</a>
			</div>
			<p id="pm_bio" class="subtitle"></p>
			<div class="chips" id="pm_skills"></div>
			<div class="row" style="margin-top:10px">
				<span id="pm_avail" class="badge"></span>
				<span id="pm_tz" class="badge"></span>
			</div>
			<div style="margin-top:12px" id="pm_links" class="row"></div>
			<div class="divider"></div>
			<div class="row" style="gap:16px">
				<div class="kpi"><div class="num" id="pm_completed">0</div><div class="lbl">Completed</div></div>
				<div class="kpi"><div class="num" id="pm_streak">0</div><div class="lbl">Streak (days)</div></div>
			</div>
			<div style="margin-top:12px">
				<h3 style="margin:0 0 8px 0; font-size:16px">Badges</h3>
				<div class="chips" id="pm_badges"></div>
			</div>
		</div>
	</div>

	<!-- Chat Modal -->
	<div id="chatModal" class="modalBack">
		<div class="modal" style="max-width:800px; height:600px; display:flex; flex-direction:column;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px; border-bottom:1px solid #333; padding-bottom:12px;">
				<div>
					<h2 id="chatTitle">üí¨ Chat</h2>
					<div id="chatGasInfo" style="font-size:12px; color:#8a8a8a;">Gas Fee: Loading...</div>
				</div>
				<a class="linkish" href="#" id="closeChat">Close ‚úï</a>
			</div>
			
			<div id="chatMessages" style="flex:1; overflow-y:auto; padding:16px; background:#0f0f0f; border-radius:8px; margin:12px 0;">
				<!-- Messages will be loaded here -->
			</div>
			
			<div style="display:flex; gap:8px; align-items:center;">
				<input type="text" id="messageInput" placeholder="Type your message..." style="flex:1; padding:12px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
				<button class="btn" onclick="sendMessage()" id="sendMessageBtn">Send</button>
			</div>
			
			<div style="display:flex; gap:8px; margin-top:8px; font-size:12px; color:#8a8a8a;">
				<span id="messageCount">0 messages</span>
				<span>‚Ä¢</span>
				<span id="gasFeeDisplay">Gas: 0.001 APT</span>
				<span>‚Ä¢</span>
				<span id="networkStatus">Network: Normal</span>
			</div>
		</div>
	</div>

	<!-- Live Quest Progress Modal -->
	<div id="questProgressModal" class="modalBack">
		<div class="modal" style="max-width:800px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üìä Live Quest Progress</h2>
				<a class="linkish" href="#" id="closeQuestProgress">Close ‚úï</a>
			</div>
			
			<div style="display:flex; gap:12px; margin:16px 0;">
				<button class="btn secondary" onclick="refreshQuestProgress()" id="refreshQuestProgressBtn">üîÑ Refresh</button>
				<button class="btn secondary" onclick="toggleQuestProgressAutoRefresh()" id="questProgressAutoRefreshBtn">‚è∞ Auto Refresh: OFF</button>
			</div>
			
			<div id="questProgressContent">
				<!-- Quest progress content will be loaded here -->
			</div>
		</div>
	</div>

	<!-- Live Leaderboard Modal -->
	<div id="leaderboardModal" class="modalBack">
		<div class="modal" style="max-width:700px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üèÜ Live Leaderboard</h2>
				<a class="linkish" href="#" id="closeLeaderboard">Close ‚úï</a>
			</div>
			
			<div style="display:flex; gap:12px; margin:16px 0;">
				<button class="btn secondary" onclick="refreshLeaderboard()" id="refreshLeaderboardBtn">üîÑ Refresh</button>
				<button class="btn secondary" onclick="toggleAutoRefresh()" id="autoRefreshBtn">‚è∞ Auto Refresh: OFF</button>
			</div>
			
			<div id="leaderboardContent">
				<!-- Leaderboard content will be loaded here -->
			</div>
		</div>
	</div>

	<!-- Activity Feed Modal -->
	<div id="activityFeedModal" class="modalBack">
		<div class="modal" style="max-width:700px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üì∞ Activity Feed</h2>
				<a class="linkish" href="#" id="closeActivityFeed">Close ‚úï</a>
			</div>
			
			<div id="activityFeedContent">
				<!-- Activity feed content will be loaded here -->
			</div>
		</div>
	</div>

	<!-- Public Profile Modal -->
	<div id="publicProfileModal" class="modalBack">
		<div class="modal" style="max-width:600px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2 id="publicProfileTitle">üë§ Public Profile</h2>
				<a class="linkish" href="#" id="closePublicProfile">Close ‚úï</a>
			</div>
			
			<div id="publicProfileContent">
				<!-- Profile content will be loaded here -->
			</div>
			
			<div style="margin-top:20px; display:flex; gap:12px; justify-content:space-between;">
				<button class="btn secondary" onclick="shareProfile()">üì§ Share Profile</button>
				<button class="btn" id="followBtn" onclick="toggleFollow()">Follow</button>
			</div>
		</div>
	</div>

	<!-- Create Profile Modal -->
	<div id="createProfileModal" class="modalBack">
		<div class="modal" style="max-width:500px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üöÄ Create Your Profile</h2>
				<a class="linkish" href="#" id="closeCreateProfile">Close ‚úï</a>
			</div>
			
			<div style="margin:16px 0;">
				<h3 style="margin:0 0 8px 0;">Avatar</h3>
				<div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; margin:8px 0;">
					<div class="avatar-option" data-avatar="üßë‚Äçüíª" onclick="selectAvatar('üßë‚Äçüíª')" style="font-size:24px; padding:8px; text-align:center; border:2px solid #333; border-radius:8px; cursor:pointer;">üßë‚Äçüíª</div>
					<div class="avatar-option" data-avatar="üë®‚Äçüíª" onclick="selectAvatar('üë®‚Äçüíª')" style="font-size:24px; padding:8px; text-align:center; border:2px solid #333; border-radius:8px; cursor:pointer;">üë®‚Äçüíª</div>
					<div class="avatar-option" data-avatar="üë©‚Äçüíª" onclick="selectAvatar('üë©‚Äçüíª')" style="font-size:24px; padding:8px; text-align:center; border:2px solid #333; border-radius:8px; cursor:pointer;">üë©‚Äçüíª</div>
					<div class="avatar-option" data-avatar="üöÄ" onclick="selectAvatar('üöÄ')" style="font-size:24px; padding:8px; text-align:center; border:2px solid #333; border-radius:8px; cursor:pointer;">üöÄ</div>
				</div>
				
				<h3 style="margin:16px 0 8px 0;">Username</h3>
				<input type="text" id="usernameInput" placeholder="Your username..." style="width:100%; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
				
				<h3 style="margin:16px 0 8px 0;">Bio</h3>
				<textarea id="bioInput" placeholder="Tell us about yourself..." style="width:100%; height:60px; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff; resize:vertical;"></textarea>
				
				<h3 style="margin:16px 0 8px 0;">Email *</h3>
				<input type="email" id="emailInput" placeholder="your@email.com" style="width:100%; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
				
				<h3 style="margin:16px 0 8px 0;">Skills</h3>
				<div class="skills-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:8px;">
					<label class="skill-checkbox" style="display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px; border:1px solid #333; border-radius:6px;">
						<input type="checkbox" value="Move" style="accent-color:#82ffa1;">
						<span style="font-size:12px;">Move</span>
					</label>
					<label class="skill-checkbox" style="display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px; border:1px solid #333; border-radius:6px;">
						<input type="checkbox" value="Rust" style="accent-color:#82ffa1;">
						<span style="font-size:12px;">Rust</span>
					</label>
					<label class="skill-checkbox" style="display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px; border:1px solid #333; border-radius:6px;">
						<input type="checkbox" value="JavaScript" style="accent-color:#82ffa1;">
						<span style="font-size:12px;">JavaScript</span>
					</label>
					<label class="skill-checkbox" style="display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px; border:1px solid #333; border-radius:6px;">
						<input type="checkbox" value="Python" style="accent-color:#82ffa1;">
						<span style="font-size:12px;">Python</span>
					</label>
					<label class="skill-checkbox" style="display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px; border:1px solid #333; border-radius:6px;">
						<input type="checkbox" value="Solidity" style="accent-color:#82ffa1;">
						<span style="font-size:12px;">Solidity</span>
					</label>
					<label class="skill-checkbox" style="display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px; border:1px solid #333; border-radius:6px;">
						<input type="checkbox" value="Web3" style="accent-color:#82ffa1;">
						<span style="font-size:12px;">Web3</span>
					</label>
				</div>
				
				<h3 style="margin:16px 0 8px 0;">Experience Level</h3>
				<select id="experienceInput" style="width:100%; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
					<option value="beginner">Beginner</option>
					<option value="intermediate">Intermediate</option>
					<option value="advanced">Advanced</option>
				</select>
				
				<h3 style="margin:16px 0 8px 0;">Social Links (Optional)</h3>
				<div style="display:grid; gap:12px;">
					<div>
						<label style="display:block; margin-bottom:4px; font-size:14px; color:#cfcfcf;">üê¶ X (Twitter) Handle</label>
						<input type="text" id="twitterInput" placeholder="@username" style="width:100%; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
					</div>
					<div>
						<label style="display:block; margin-bottom:4px; font-size:14px; color:#cfcfcf;">üíª GitHub Username</label>
						<input type="text" id="githubInput" placeholder="username" style="width:100%; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
					</div>
					<div>
						<label style="display:block; margin-bottom:4px; font-size:14px; color:#cfcfcf;">üíº LinkedIn (Optional)</label>
						<input type="text" id="linkedinInput" placeholder="linkedin.com/in/username" style="width:100%; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:6px; color:#fff;">
					</div>
				</div>
				
				<h3 style="margin:16px 0 8px 0;">Privacy Settings</h3>
				<div style="display:flex; flex-direction:column; gap:8px;">
					<label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
						<input type="radio" name="privacy" value="public" checked style="accent-color:#82ffa1;">
						<span>üåê Public Profile (Others can see your progress)</span>
					</label>
					<label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
						<input type="radio" name="privacy" value="private" style="accent-color:#82ffa1;">
						<span>üîí Private Profile (Only you can see your progress)</span>
					</label>
				</div>
			</div>
			
			<div style="display:flex; gap:12px; justify-content:flex-end;">
				<button class="btn secondary" onclick="closeCreateProfile()">Cancel</button>
				<button class="btn" onclick="saveProfile()">Save Profile</button>
			</div>
		</div>
	</div>

	<!-- Quest Content Modal -->
	<div id="questContentModal" class="modalBack">
		<div class="modal" style="max-width:800px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2 id="questContentTitle">Quest Content</h2>
				<a class="linkish" href="#" id="closeQuestContent">Close ‚úï</a>
			</div>
			<div id="questContentBody"></div>
			<div style="margin-top:20px; display:flex; gap:12px; justify-content:space-between;">
				<button class="btn secondary" id="prevStep">‚Üê Previous</button>
				<div style="flex:1; text-align:center;">
					<span id="stepIndicator">Step 1 of 3</span>
				</div>
				<button class="btn" id="nextStep">Next ‚Üí</button>
			</div>
		</div>
	</div>

	<!-- Mentorship Modal -->
	<div id="mentorshipModal" class="modalBack">
		<div class="modal" style="max-width:600px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üë• Available Mentors</h2>
				<a class="linkish" href="#" id="closeMentorship">Close ‚úï</a>
			</div>
			<div id="mentorList"></div>
		</div>
	</div>

	<!-- Pair Programming Modal -->
	<div id="pairProgrammingModal" class="modalBack">
		<div class="modal" style="max-width:500px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>ü§ù Pair Programming Sessions</h2>
				<a class="linkish" href="#" id="closePairProgramming">Close ‚úï</a>
			</div>
			<div id="pairSessionList">
				<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0; cursor:pointer;" onclick="joinPairSession(1)">
					<strong>Quest 1: Basic Move Syntax</strong><br>
					<small>2 developers waiting ‚Ä¢ Starting in 15 min</small>
				</div>
				<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0; cursor:pointer;" onclick="joinPairSession(2)">
					<strong>Quest 3: Resource Model</strong><br>
					<small>1 developer waiting ‚Ä¢ Starting in 45 min</small>
				</div>
				<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0; cursor:pointer;" onclick="joinPairSession(3)">
					<strong>Custom DeFi Project</strong><br>
					<small>3 developers online ‚Ä¢ Starting now</small>
				</div>
			</div>
		</div>
	</div>

	<!-- Personal Dashboard Modal -->
	<div id="personalDashboardModal" class="modalBack">
		<div class="modal" style="max-width:700px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2 id="dashboardTitle">üìä My Learning Dashboard</h2>
				<a class="linkish" href="#" id="closeDashboard">Close ‚úï</a>
			</div>
			<div id="dashboardContent">
				<div style="display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(150px,1fr)); margin:16px 0;">
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px; background:#0f1f0f;">
						<div style="font-size:24px; font-weight:700; color:#82ffa1;" id="userQuestsCompleted">0</div>
						<div style="font-size:12px; color:#cfcfcf;">Quests Completed</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px; background:#0f1f0f;">
						<div style="font-size:24px; font-weight:700; color:#82ffa1;" id="userStreak">0</div>
						<div style="font-size:12px; color:#cfcfcf;">Day Streak</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px; background:#0f1f0f;">
						<div style="font-size:24px; font-weight:700; color:#82ffa1;" id="userLevel">1</div>
						<div style="font-size:12px; color:#cfcfcf;">Level</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px; background:#0f1f0f;">
						<div style="font-size:24px; font-weight:700; color:#82ffa1;" id="userXP">0</div>
						<div style="font-size:12px; color:#cfcfcf;">XP Points</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px; background:#0f1f0f;">
						<div style="font-size:24px; font-weight:700; color:#82ffa1;" id="userFollowers">0</div>
						<div style="font-size:12px; color:#cfcfcf;">Followers</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px; background:#0f1f0f;">
						<div style="font-size:24px; font-weight:700; color:#82ffa1;" id="userFollowing">0</div>
						<div style="font-size:12px; color:#cfcfcf;">Following</div>
					</div>
				</div>
				
				<!-- Quest Completion History -->
				<h3>üìà Quest Completion History</h3>
				<div id="questHistory" style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:16px; margin:8px 0;">
					<div style="display:grid; gap:8px;">
						<!-- Quest history items will be loaded here -->
					</div>
				</div>
				
				<!-- Achievement Showcase -->
				<h3>üèÜ Achievement Showcase</h3>
				<div id="userBadges" class="chips"></div>
				
				<!-- Activity Timeline -->
				<h3>üìÖ Recent Activity</h3>
				<div id="activityTimeline" style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:16px; margin:8px 0;">
					<div style="display:grid; gap:12px;">
						<!-- Activity items will be loaded here -->
					</div>
				</div>
				
				<!-- Profile Management -->
				<div style="margin-top:20px; display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap;">
					<button class="btn secondary" onclick="editProfile()">‚úèÔ∏è Edit Profile</button>
					<button class="btn secondary" onclick="shareProfile()">üì§ Share Profile</button>
					<button class="btn secondary" onclick="openActivityFeed()">üì∞ Activity Feed</button>
					<button class="btn secondary" onclick="openQuestProgress()">üìä Quest Progress</button>
					<button class="btn secondary" onclick="toggleDashboardAutoRefresh()" id="dashboardAutoRefreshBtn">üîÑ Auto Refresh: OFF</button>
					<button class="btn" onclick="viewPublicProfile()">üëÅÔ∏è View Public Profile</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Move Code Editor Modal -->
	<div id="codeEditorModal" class="modalBack">
		<div class="modal" style="max-width:900px; max-height:90vh;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>‚ö° Move Code Editor</h2>
				<a class="linkish" href="#" id="closeCodeEditor">Close ‚úï</a>
			</div>
			<div style="margin:16px 0;">
				<div style="display:flex; gap:8px; margin-bottom:12px;">
					<button class="btn secondary" onclick="loadTemplate('basic')" style="font-size:12px;">Basic Template</button>
					<button class="btn secondary" onclick="loadTemplate('coin')" style="font-size:12px;">Coin Template</button>
					<button class="btn secondary" onclick="loadTemplate('defi')" style="font-size:12px;">DeFi Template</button>
					<button class="btn" onclick="runMoveCode()" style="font-size:12px;">üöÄ Run Code</button>
				</div>
				<textarea id="moveCodeEditor" style="width:100%; height:300px; background:#1a1a1a; color:#fff; border:1px solid #333; border-radius:8px; padding:12px; font-family:monospace; font-size:13px;" placeholder="// Write your Move code here...
module 0x1::hello_world {
    public fun hello(): vector<u8> {
        b&quot;Hello, Move!&quot;
    }
}"></textarea>
				<div id="codeOutput" style="background:#0f0f0f; border:1px solid #333; border-radius:8px; padding:12px; margin-top:8px; min-height:60px; font-family:monospace; font-size:12px;">
					<div style="color:#82ffa1;">üìù Code output will appear here...</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Hackathon Modal -->
	<div id="hackathonModal" class="modalBack">
		<div class="modal" style="max-width:600px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üèÜ Upcoming Mini-Hackathons</h2>
				<a class="linkish" href="#" id="closeHackathon">Close ‚úï</a>
			</div>
			<div style="margin:16px 0;">
				<div style="padding:16px; border:1px solid #333; border-radius:8px; margin:12px 0; cursor:pointer; transition:all 0.2s ease;" onclick="registerHackathon('defi')" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#333'">
					<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
						<strong style="color:#82ffa1;">Move DeFi Challenge</strong>
						<span class="chip">Prize: 50 APT</span>
					</div>
					<p style="margin:0 0 8px 0; color:#cfcfcf;">Build innovative DeFi protocols using Move language</p>
					<div style="display:flex; gap:8px;">
						<span class="chip">Jan 15-17, 2025</span>
						<span class="chip">3 days</span>
						<span class="chip">Remote</span>
					</div>
					<div style="margin-top:8px; font-size:12px; color:#82ffa1;">
						üëÜ Click to register
					</div>
				</div>
				
				<div style="padding:16px; border:1px solid #333; border-radius:8px; margin:12px 0; cursor:pointer; transition:all 0.2s ease;" onclick="registerHackathon('nft')" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#333'">
					<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
						<strong style="color:#82ffa1;">NFT Innovation Sprint</strong>
						<span class="chip">Prize: 30 APT</span>
					</div>
					<p style="margin:0 0 8px 0; color:#cfcfcf;">Create unique NFT projects and marketplaces</p>
					<div style="display:flex; gap:8px;">
						<span class="chip">Jan 22-24, 2025</span>
						<span class="chip">3 days</span>
						<span class="chip">Hybrid</span>
					</div>
					<div style="margin-top:8px; font-size:12px; color:#82ffa1;">
						üëÜ Click to register
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
	(function(){
		// Quests catalog
		const quests = [
			{ id:1, title:'üéØ Basic Move Syntax', diff:'Beginner', reward:'10 APT', desc:'Move basics: variables, functions, types.' },
			{ id:2, title:'üîß Struct & Functions', diff:'Intermediate', reward:'20 APT', desc:'Structs, public functions, and modular design.' },
			{ id:3, title:'üí∞ Resource Model', diff:'Advanced', reward:'40 APT', desc:'Resource safety, abilities, and ownership model.' },
			{ id:4, title:'üîÑ Control Flow', diff:'Beginner', reward:'12 APT', desc:'Conditionals, loops, and patterns.' },
			{ id:5, title:'üì¶ Modules', diff:'Intermediate', reward:'25 APT', desc:'Module design, visibility, dependencies.' },
			{ id:6, title:'üõ°Ô∏è Security', diff:'Advanced', reward:'50 APT', desc:'Security best practices, testing, and reviews.' }
		];

		// Builder profiles (updated names)
		const profiles = [
			{ id:1, name:'Ne≈üe Demir', handle:'@nese', bio:'Focused on Move security & smart contract auditing.', skills:['Move','Security','Auditing','Testing'], tz:'GMT+3', avail:'Mentor: Available', completed: 35, streak: 16, badges:['Security Expert','Auditor','Top Contributor'], links:[{t:'GitHub',u:'https://github.com/'},{t:'X',u:'https://x.com/'}] },
			{ id:2, name:'Deniz Arda', handle:'@deniz', bio:'Tooling and developer experience.', skills:['Move','Tooling','DX','CLI'], tz:'GMT+1', avail:'Mentor: Busy', completed: 20, streak: 5, badges:['DX Builder','CLI Wizard'], links:[{t:'GitHub',u:'https://github.com/'},{t:'Site',u:'#'}] },
			{ id:3, name:'Efe Can', handle:'@efecan', bio:'Quests and education content.', skills:['Move','Education','Docs'], tz:'GMT+2', avail:'Mentor: Available', completed: 18, streak: 9, badges:['Educator','Quest Maker'], links:[{t:'GitHub',u:'https://github.com/'}] },
			{ id:4, name:'Dilek √ñzkan', handle:'@dilek', bio:'DeFi protocols and yield farming specialist.', skills:['DeFi','Protocols','Yield','Finance'], tz:'GMT+3', avail:'Mentor: Available', completed: 29, streak: 18, badges:['DeFi Master','Protocol Builder'], links:[{t:'GitHub',u:'https://github.com/'},{t:'LinkedIn',u:'https://linkedin.com/'}] },
			{ id:5, name:'Okan T.', handle:'@okant', bio:'Collaboration & hackathon facilitator.', skills:['Collab','Hackathons','PM'], tz:'GMT+3', avail:'Mentor: Busy', completed: 14, streak: 3, badges:['Facilitator'], links:[{t:'GitHub',u:'https://github.com/'}] },
			{ id:6, name:'Selin A.', handle:'@selina', bio:'Analytics and platform metrics.', skills:['Analytics','Metrics','Dashboards'], tz:'GMT-1', avail:'Mentor: Available', completed: 22, streak: 12, badges:['Insights Pro'], links:[{t:'GitHub',u:'https://github.com/'}] }
		];

		// Elements
		const exploreBtn = document.getElementById('exploreQuests');
		const modal = document.getElementById('questsModal');
		const closeModal = document.getElementById('closeModal');
		const grid = document.getElementById('qgrid');

		const profilesGrid = document.getElementById('profilesGrid');
		const pModal = document.getElementById('profileModal');
		const pmClose = document.getElementById('pm_close');
		const pmName = document.getElementById('pm_name');
		const pmBio = document.getElementById('pm_bio');
		const pmSkills = document.getElementById('pm_skills');
		const pmAvail = document.getElementById('pm_avail');
		const pmTz = document.getElementById('pm_tz');
		const pmLinks = document.getElementById('pm_links');
		const pmCompleted = document.getElementById('pm_completed');
		const pmStreak = document.getElementById('pm_streak');
		const pmBadges = document.getElementById('pm_badges');

		// Render profiles (3-3 grid), include quick summary
		profilesGrid.innerHTML = profiles.map(p => `
			<div class="card">
				<h3>${p.name} <span style="color:#bdbdbd; font-weight:400">${p.handle}</span></h3>
				<p>${p.bio}</p>
				<div class="chips">
					${p.skills.map(s => `<span class=\"chip\">${s}</span>`).join('')}
				</div>
				${p.links && p.links.length > 0 ? `
					<div style="display:flex; gap:8px; justify-content:center; margin:8px 0;">
						${p.links.map(link => {
							const icon = link.t === 'GitHub' ? 'üíª' : link.t === 'X' ? 'üê¶' : link.t === 'LinkedIn' ? 'üíº' : 'üîó';
							return `<a href="${link.u}" target="_blank" style="color:#82ffa1; text-decoration:none; font-size:16px;" title="${link.t}">${icon}</a>`;
						}).join('')}
					</div>
				` : ''}
				<div class="row" style="margin-top:10px; justify-content:space-between;">
					<span class="badge">Completed: ${p.completed}</span>
					<span class="badge">Streak: ${p.streak}d</span>
				</div>
				<div class="row" style="margin-top:12px; gap:8px;">
					<button class="btn" data-profile="${p.id}" style="flex:1;">View Profile</button>
					<button class="btn secondary" onclick="followUser('${p.handle}')" style="flex:1;">Follow</button>
					<button class="btn secondary" onclick="openChat('${p.handle}', '${p.name}')" style="flex:1;">üí¨ Message</button>
				</div>
			</div>
		`).join('');

		profilesGrid.addEventListener('click', (e) => {
			const t = e.target;
			if (t && t instanceof Element && t.getAttribute('data-profile')) {
				const id = Number(t.getAttribute('data-profile'));
				const p = profiles.find(x => x.id === id);
				if (!p) return;
				pmName.textContent = p.name + ' ' + p.handle;
				pmBio.textContent = p.bio;
				pmSkills.innerHTML = p.skills.map(s => `<span class=\"chip\">${s}</span>`).join('');
				pmAvail.textContent = p.avail;
				pmTz.textContent = p.tz;
				pmLinks.innerHTML = p.links.map(l => `<a class=\"linkish\" href=\"${l.u}\" target=\"_blank\">${l.t}</a>`).join(' ¬∑ ');
				pmCompleted.textContent = String(p.completed);
				pmStreak.textContent = String(p.streak);
				pmBadges.innerHTML = (p.badges || []).map(b => `<span class=\"chip\">${b}</span>`).join('');
				pModal.style.display = 'grid';
			}
		});

		pmClose.addEventListener('click', (e) => { e.preventDefault(); pModal.style.display='none'; });
		pModal.addEventListener('click', (e) => { if (e.target === pModal) pModal.style.display='none'; });

		// Enhanced quests modal
		exploreBtn.addEventListener('click', () => {
			grid.innerHTML = quests.map(q => `
				<div class=\"qcard\">
					<div class=\"qtop\">
						<h3 style=\"margin:0; font-size:16px\">${q.title}</h3>
						<span class=\"qdiff\">${q.diff}</span>
					</div>
					<p class=\"qdesc\">${q.desc}</p>
					<div class=\"qrow\" style=\"margin-bottom:8px;\">
						<span class=\"qreward\">Reward: ${q.reward}</span>
						<div style=\"display:flex; gap:4px; align-items:center;\">
							<button class=\"btn secondary\" onclick=\"likeQuest(${q.id}, '‚ù§Ô∏è')\" style=\"padding:4px 8px; font-size:12px;\">
								‚ù§Ô∏è <span id=\"likes-${q.id}\">${q.likes || 0}</span>
							</button>
							<button class=\"btn secondary\" onclick=\"likeQuest(${q.id}, 'üî•')\" style=\"padding:4px 8px; font-size:12px;\">
								üî• <span id=\"fire-${q.id}\">${q.fire || 0}</span>
							</button>
							<button class=\"btn secondary\" onclick=\"likeQuest(${q.id}, 'üöÄ')\" style=\"padding:4px 8px; font-size:12px;\">
								üöÄ <span id=\"rocket-${q.id}\">${q.rocket || 0}</span>
							</button>
						</div>
					</div>
					<div class=\"qrow\">
						<button class=\"btn\" onclick=\"startQuest(${q.id})\" style=\"width:100%;\">${walletConnected ? 'Start Quest' : 'Connect Wallet'}</button>
					</div>
				</div>
			`).join('');
			modal.style.display = 'grid';
		});

		// Quest content modal elements
		const questContentModal = document.getElementById('questContentModal');
		const questContentTitle = document.getElementById('questContentTitle');
		const questContentBody = document.getElementById('questContentBody');
		const stepIndicator = document.getElementById('stepIndicator');
		const prevStepBtn = document.getElementById('prevStep');
		const nextStepBtn = document.getElementById('nextStep');
		const closeQuestContent = document.getElementById('closeQuestContent');

		// Start quest function
		window.startQuest = function(questId) {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}

			const questContent = questContents[questId];
			if (questContent) {
				currentQuestId = questId;
				currentStep = 0;
				showQuestContent();
				modal.style.display = 'none';
			} else {
				alert('Quest content coming soon!');
			}
		};

		function showQuestContent() {
			const questContent = questContents[currentQuestId];
			if (!questContent) return;

			questContentTitle.textContent = questContent.title;
			questContentBody.innerHTML = questContent.steps[currentStep].content;
			stepIndicator.textContent = `Step ${currentStep + 1} of ${questContent.steps.length}`;
			
			prevStepBtn.style.display = currentStep > 0 ? 'block' : 'none';
			nextStepBtn.textContent = currentStep === questContent.steps.length - 1 ? 'Complete Quest' : 'Next ‚Üí';
			
			questContentModal.style.display = 'grid';
		}

		// Quest navigation
		prevStepBtn.addEventListener('click', () => {
			if (currentStep > 0) {
				currentStep--;
				showQuestContent();
			}
		});

		nextStepBtn.addEventListener('click', () => {
			const questContent = questContents[currentQuestId];
			if (currentStep < questContent.steps.length - 1) {
				currentStep++;
				showQuestContent();
			} else {
				questContentModal.style.display = 'none';
				const quest = quests.find(q => q.id === currentQuestId);
				completeQuestWithSharing(currentQuestId, quest.title);
			}
		});

		closeQuestContent.addEventListener('click', (e) => {
			e.preventDefault();
			questContentModal.style.display = 'none';
		});

		questContentModal.addEventListener('click', (e) => {
			if (e.target === questContentModal) {
				questContentModal.style.display = 'none';
			}
		});

		closeModal.addEventListener('click', (e) => { e.preventDefault(); modal.style.display='none'; });
		modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display='none'; });

		document.getElementById('viewStats').addEventListener('click', () => {
			alert('Analytics: DAU, quest completion rate, avg difficulty. (Will load from on-chain once HTTPS is enabled)');
		});

		// Enhanced functionality
		let walletConnected = false;
		let walletAddress = null;
		let userProfile = null;
		let selectedAvatar = 'üßë‚Äçüíª';
		let currentQuestId = null;
		let currentStep = 0;
		let notificationPermission = false;

		// Quest content data
		const questContents = {
			1: {
				title: 'üéØ Basic Move Syntax',
				steps: [
					{
						title: 'Challenge 1: Variable Declaration',
						content: `<h3>üéØ Your Mission</h3><p>Complete this Move function:</p><div style="background:#2a2a2a; padding:12px; border-radius:8px; margin:8px 0;"><pre><code>fun init_user(): (u64, address, bool) {
    let balance: u64 = <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>;  // Set to 1000
    let addr: address = <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>;  // Set to @0x1
    let active: bool = <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>;   // Set to true
    (balance, addr, active)
}</code></pre></div><p><strong>Fill in:</strong> 1000, @0x1, true</p>`
					},
					{
						title: 'Challenge 2: Functions',
						content: `<h3>üéØ Complete the Calculator</h3><div style="background:#2a2a2a; padding:12px; border-radius:8px;"><pre><code>public fun add(a: u64, b: u64): u64 {
    <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>  // Return a + b
}

public fun multiply(x: u64, y: u64): u64 {
    <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>  // Return x * y
}</code></pre></div><p><strong>Answers:</strong> a + b, x * y</p>`
					},
					{
						title: 'Quest Complete!',
						content: `<div style="background:#1a4a2e; padding:16px; border-radius:8px; text-align:center;"><h3>üéâ Quest Completed!</h3><p>You've mastered Move basics!</p><p><strong>Reward:</strong> 0.1 APT + "Move Beginner" badge</p></div>`
					}
				]
			},
			2: {
				title: 'üîß Struct & Functions',
				steps: [
					{
						title: 'Challenge: Build User Profile',
						content: `<h3>üéØ Create a User Struct</h3><div style="background:#2a2a2a; padding:12px; border-radius:8px;"><pre><code>struct User has copy, drop {
    name: vector&lt;u8&gt;,
    level: <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>,     // u8 type
    balance: <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>,  // u64 type
}</code></pre></div><p><strong>Fill in:</strong> u8, u64</p>`
					},
					{
						title: 'Quest Complete!',
						content: `<div style="background:#1a4a2e; padding:16px; border-radius:8px; text-align:center;"><h3>üéâ Struct Master!</h3><p>You understand Move structs!</p><p><strong>Reward:</strong> 0.2 APT + "Struct Expert" badge</p></div>`
					}
				]
			},
			3: {
				title: 'üí∞ Resource Model',
				steps: [
					{
						title: 'Challenge: Secure Coin',
						content: `<h3>üéØ Create Secure Resource</h3><div style="background:#2a2a2a; padding:12px; border-radius:8px;"><pre><code>struct Coin has <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span> {  // Only "store" - no copy/drop
    value: u64,
}</code></pre></div><p><strong>Answer:</strong> store (Resources can't be copied or dropped for security!)</p>`
					},
					{
						title: 'Quest Complete!',
						content: `<div style="background:#1a4a2e; padding:16px; border-radius:8px; text-align:center;"><h3>üéâ Security Expert!</h3><p>You understand Move resources!</p><p><strong>Reward:</strong> 0.4 APT + "Security Pro" badge</p></div>`
					}
				]
			},
			4: {
				title: 'üîÑ Control Flow',
				steps: [
					{
						title: 'Challenge: Access Control',
						content: `<h3>üéØ Build Access Control</h3><div style="background:#2a2a2a; padding:12px; border-radius:8px;"><pre><code>public fun check_access(level: u8, premium: bool): bool {
    if (level >= <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>) {  // VIP level 10+
        return true
    };
    if (premium) {
        return true
    };
    false
}</code></pre></div><p><strong>Fill in:</strong> 10</p>`
					},
					{
						title: 'Quest Complete!',
						content: `<div style="background:#1a4a2e; padding:16px; border-radius:8px; text-align:center;"><h3>üéâ Logic Master!</h3><p>Control flow mastered!</p><p><strong>Reward:</strong> 0.12 APT + "Logic Expert" badge</p></div>`
					}
				]
			},
			5: {
				title: 'üì¶ Modules',
				steps: [
					{
						title: 'Challenge: Module Design',
						content: `<h3>üéØ Create DeFi Module</h3><div style="background:#2a2a2a; padding:12px; border-radius:8px;"><pre><code>module 0x1::defi_core {
    use std::signer;
    
    struct Pool has <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span> {  // "key" for global storage
        token_a: u64,
        token_b: u64,
    }
}</code></pre></div><p><strong>Answer:</strong> key</p>`
					},
					{
						title: 'Quest Complete!',
						content: `<div style="background:#1a4a2e; padding:16px; border-radius:8px; text-align:center;"><h3>üéâ Module Architect!</h3><p>Module design mastered!</p><p><strong>Reward:</strong> 0.25 APT + "Architect" badge</p></div>`
					}
				]
			},
			6: {
				title: 'üõ°Ô∏è Security',
				steps: [
					{
						title: 'Challenge: Security Patterns',
						content: `<h3>üéØ Secure Withdrawal</h3><div style="background:#2a2a2a; padding:12px; border-radius:8px;"><pre><code>public entry fun withdraw(account: &signer, amount: u64) {
    // Security check
    assert!(amount <= <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 4px;">_____</span>, E_INSUFFICIENT_FUNDS);  // user.balance
    
    user.balance = user.balance - amount;
}</code></pre></div><p><strong>Answer:</strong> user.balance</p>`
					},
					{
						title: 'Quest Complete!',
						content: `<div style="background:#1a4a2e; padding:16px; border-radius:8px; text-align:center;"><h3>üéâ Security Auditor!</h3><p>Security expert achieved!</p><p><strong>Reward:</strong> 0.5 APT + "Security Pro" badge</p></div>`
					}
				]
			}
		};

		// Mobile detection
		function isMobile() {
			return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
		}

		async function connectWallet() {
			console.log('üîó Connect wallet clicked');
			
			// First check if Petra is available
			console.log('üîç window.aptos:', window.aptos);
			
			try {
				if (!window.aptos) {
					alert('‚ùå Petra wallet not detected!\n\nPlease:\n1. Install Petra extension\n2. Refresh the page\n3. Try again');
					window.open('https://petra.app/', '_blank');
					return;
				}
				
				console.log('üì± Petra detected, calling connect...');
				alert('üì± Petra detected! Click OK, then approve in wallet popup.');
				
				const response = await window.aptos.connect();
				console.log('‚úÖ Wallet response:', response);
				
				walletAddress = response.address;
				walletConnected = true;
				updateWalletUI();
				
				// Check if profile exists
				const savedProfile = localStorage.getItem(`profile_${walletAddress}`);
				if (savedProfile) {
					userProfile = JSON.parse(savedProfile);
					alert('‚úÖ Welcome back, ' + userProfile.username + '!');
				} else {
					alert('‚úÖ Wallet connected! Create your profile to get started.');
					setTimeout(() => {
						document.getElementById('createProfileModal').style.display = 'grid';
					}, 1000);
				}
			} catch (error) {
				console.error('‚ùå Wallet error:', error);
				alert('‚ùå Error: ' + error.message);
			}
		}

		async function disconnectWallet() {
			try {
				if (window.aptos) await window.aptos.disconnect();
				walletConnected = false;
				walletAddress = null;
				updateWalletUI();
				alert('Wallet disconnected');
			} catch (error) {
				console.error('Disconnect failed');
			}
		}

		function updateWalletUI() {
			const connectBtn = document.getElementById('connectWallet');
			const walletInfo = document.getElementById('walletInfo');
			const addressDiv = document.getElementById('walletAddress');

			if (walletConnected && walletAddress) {
				connectBtn.style.display = 'none';
				walletInfo.style.display = 'block';
				addressDiv.textContent = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
			} else {
				connectBtn.style.display = 'block';
				walletInfo.style.display = 'none';
			}
		}

		// Referral system
		function checkReferral() {
			const urlParams = new URLSearchParams(window.location.search);
			const referralCode = urlParams.get('ref');
			
			if (referralCode && !localStorage.getItem('referral_used')) {
				localStorage.setItem('referral_code', referralCode);
				alert('üéÅ Referral bonus! You\'ll get +10% rewards!');
			}
		}

		// Referral link generation
		document.getElementById('getReferralLink').addEventListener('click', () => {
			if (!walletConnected) {
				alert('Please connect wallet first!');
				return;
			}
			
			const referralCode = walletAddress.slice(-8);
			const referralLink = `https://movebuildershub.xyz?ref=${referralCode}`;
			
			navigator.clipboard.writeText(referralLink).then(() => {
				alert(`üîó Referral link copied!\n\n${referralLink}\n\nFriends get +10% rewards!`);
			});
		});

		// Initialize everything
		checkReferral();
		
		setTimeout(() => {
			if (window.aptos) {
				document.getElementById('connectWallet').style.display = 'block';
				console.log('‚úÖ Petra wallet detected');
			} else {
				document.getElementById('connectWallet').style.display = 'block';
				document.getElementById('connectWallet').textContent = 'Install Petra Wallet';
				console.log('‚ùå Petra wallet not found');
			}
		}, 1000);

		// Profile functions
		window.selectAvatar = function(avatar) {
			selectedAvatar = avatar;
			document.querySelectorAll('.avatar-option').forEach(option => {
				option.style.borderColor = '#333';
			});
			document.querySelector(`[data-avatar="${avatar}"]`).style.borderColor = '#82ffa1';
		};

		window.closeCreateProfile = function() {
			document.getElementById('createProfileModal').style.display = 'none';
		};

		window.saveProfile = function() {
			const username = document.getElementById('usernameInput').value.trim();
			const bio = document.getElementById('bioInput').value.trim();
			const email = document.getElementById('emailInput').value.trim();
			const experience = document.getElementById('experienceInput').value;
			const privacy = document.querySelector('input[name="privacy"]:checked').value;
			const twitter = document.getElementById('twitterInput').value.trim();
			const github = document.getElementById('githubInput').value.trim();
			const linkedin = document.getElementById('linkedinInput').value.trim();
			
			// Get selected skills
			const skillCheckboxes = document.querySelectorAll('.skill-checkbox input[type="checkbox"]:checked');
			const skills = Array.from(skillCheckboxes).map(cb => cb.value);

			// Security validation
			if (!username) {
				alert('Please enter a username!');
				return;
			}

			if (!email) {
				alert('Please enter your email!');
				return;
			}

			if (!validateInput(username, 'username')) {
				alert('‚ùå Invalid username!\n\nUsername must be:\n‚Ä¢ 3-20 characters\n‚Ä¢ Letters, numbers, underscore, dash only');
				return;
			}

			if (!validateInput(bio, 'bio')) {
				alert('‚ùå Bio too long! Maximum 200 characters.');
				return;
			}

			// Email validation
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if (!emailRegex.test(email)) {
				alert('‚ùå Please enter a valid email address!');
				return;
			}

			// Social links validation (optional)
			const socialLinks = {};
			if (twitter) {
				if (!twitter.startsWith('@')) {
					alert('‚ùå Twitter handle should start with @ (e.g., @username)');
					return;
				}
				socialLinks.twitter = twitter;
			}
			if (github) {
				// Basic GitHub username validation
				if (!/^[a-zA-Z0-9]([a-zA-Z0-9]|-(?=[a-zA-Z0-9])){0,38}$/.test(github)) {
					alert('‚ùå Please enter a valid GitHub username');
					return;
				}
				socialLinks.github = github;
			}
			if (linkedin) {
				// Basic LinkedIn URL validation
				if (!linkedin.includes('linkedin.com/in/')) {
					alert('‚ùå Please enter a valid LinkedIn URL (e.g., linkedin.com/in/username)');
					return;
				}
				socialLinks.linkedin = linkedin;
			}

			userProfile = {
				avatar: selectedAvatar,
				username: username,
				bio: bio || 'Move developer',
				email: email,
				skills: skills,
				experience: experience,
				privacy: privacy,
				socialLinks: socialLinks,
				walletAddress: walletAddress,
				createdAt: new Date().toISOString(),
				questsCompleted: 0,
				streak: 0,
				badges: ['New Builder'],
				followers: [],
				following: [],
				profileLink: `https://movebuildershub.xyz/profile/${username.toLowerCase().replace(/[^a-z0-9]/g, '')}`
			};

			localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
			closeCreateProfile();
			updateWalletUI();
			
			// Add activity to timeline
			addActivity('üë§', 'Created profile');
			
			alert('‚úÖ Profile created successfully!');
		};

		function updateWalletUI() {
			const connectBtn = document.getElementById('connectWallet');
			const walletInfo = document.getElementById('walletInfo');
			const addressDiv = document.getElementById('walletAddress');

			if (walletConnected && walletAddress) {
				connectBtn.style.display = 'none';
				walletInfo.style.display = 'block';
				
				if (userProfile) {
					addressDiv.innerHTML = `${userProfile.avatar} ${userProfile.username}`;
				} else {
					addressDiv.textContent = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
				}
			} else {
				connectBtn.style.display = 'block';
				walletInfo.style.display = 'none';
			}
		}

		// Close profile modal events
		document.getElementById('closeCreateProfile').addEventListener('click', (e) => {
			e.preventDefault();
			closeCreateProfile();
		});

		document.getElementById('createProfileModal').addEventListener('click', (e) => {
			if (e.target.id === 'createProfileModal') {
				closeCreateProfile();
			}
		});

		// Scroll functions for highlights
		window.scrollToQuests = function() {
			document.getElementById('exploreQuests').click();
		};

		window.scrollToMentorship = function() {
			document.getElementById('findMentorBtn').scrollIntoView({ behavior: 'smooth', block: 'center' });
		};

		window.scrollToCollaboration = function() {
			// Find "Active Collaborations" section
			const allH3 = document.querySelectorAll('h3');
			let collabSection = null;
			
			allH3.forEach(h3 => {
				if (h3.textContent.includes('üî• Active Collaborations')) {
					collabSection = h3;
				}
			});
			
			if (collabSection) {
				collabSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
			} else {
				// Fallback to first collaboration card
				const firstCollabCard = document.querySelector('[onclick*="joinCollaboration"]');
				if (firstCollabCard) {
					firstCollabCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
				}
			}
		};

		window.scrollToRewards = function() {
			document.getElementById('viewSponsorPools').scrollIntoView({ behavior: 'smooth', block: 'center' });
		};

		window.scrollToAnalytics = function() {
			document.getElementById('questChart').scrollIntoView({ behavior: 'smooth', block: 'center' });
		};

		window.scrollToProfiles = function() {
			document.getElementById('profilesGrid').scrollIntoView({ behavior: 'smooth', block: 'center' });
		};

		// Enhanced mentorship system
		document.getElementById('findMentorBtn').addEventListener('click', () => {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			
			// Show mentorship modal
			const mentorList = document.getElementById('mentorList');
			const availableMentors = profiles.filter(p => p.avail.includes('Available'));
			
			mentorList.innerHTML = availableMentors.map(mentor => `
				<div style="padding:16px; border:1px solid #333; border-radius:8px; margin:12px 0; background:#0f1f0f;">
					<div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
						<span style="font-size:24px;">üë§</span>
						<div>
							<h4 style="margin:0; color:#82ffa1;">${mentor.name}</h4>
							<p style="margin:0; font-size:12px; color:#cfcfcf;">${mentor.bio}</p>
						</div>
					</div>
					<div style="margin:8px 0;">
						${mentor.skills.map(skill => `<span class="chip">${skill}</span>`).join('')}
					</div>
					<div style="display:flex; gap:8px; margin-top:12px;">
						<button class="btn" onclick="bookMentor('${mentor.handle}', '${mentor.name}')" style="font-size:12px;">üìÖ Book Session</button>
						<span class="badge">${mentor.avail}</span>
						<span class="badge">${mentor.tz}</span>
					</div>
				</div>
			`).join('');
			
			document.getElementById('mentorshipModal').style.display = 'grid';
		});

		// Enhanced pair programming
		document.getElementById('joinPairBtn').addEventListener('click', () => {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			
			document.getElementById('pairProgrammingModal').style.display = 'grid';
		});

		// Enhanced mentor booking with clickable options
		window.bookMentor = function(handle, name) {
			// Update mentor list to show session options
			const mentorList = document.getElementById('mentorList');
			mentorList.innerHTML = `
				<div style="text-align:center; margin-bottom:16px;">
					<h3 style="margin:0; color:#82ffa1;">üìÖ Book Session with ${name}</h3>
					<p style="margin:8px 0; color:#cfcfcf;">Choose your preferred session type:</p>
				</div>
				
				<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0; cursor:pointer; transition:all 0.2s ease;" onclick="confirmBooking('${name}', 'intro')" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#333'">
					<strong>Introduction Session</strong><br>
					<small>30 minutes ‚Ä¢ Free ‚Ä¢ Perfect for beginners</small>
				</div>
				
				<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0; cursor:pointer; transition:all 0.2s ease;" onclick="confirmBooking('${name}', 'deep')" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#333'">
					<strong>Deep Dive Session</strong><br>
					<small>1 hour ‚Ä¢ 0.1 APT ‚Ä¢ Advanced topics & code review</small>
				</div>
				
				<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0; cursor:pointer; transition:all 0.2s ease;" onclick="confirmBooking('${name}', 'project')" onmouseover="this.style.borderColor='#82ffa1'" onmouseout="this.style.borderColor='#333'">
					<strong>Project Review</strong><br>
					<small>45 minutes ‚Ä¢ 0.15 APT ‚Ä¢ Portfolio & project feedback</small>
				</div>
				
				<div style="text-align:center; margin-top:16px;">
					<button class="btn secondary" onclick="location.reload()" style="font-size:12px;">‚Üê Back to Mentors</button>
				</div>
			`;
		};

		// Confirm booking function
		window.confirmBooking = function(mentorName, sessionType) {
			const sessions = {
				'intro': 'Introduction Session (30 min) - Free',
				'deep': 'Deep Dive Session (1 hour) - 0.1 APT',
				'project': 'Project Review (45 min) - 0.15 APT'
			};
			
			document.getElementById('mentorshipModal').style.display = 'none';
			alert(`‚úÖ Session booked with ${mentorName}!\n\nüìÖ ${sessions[sessionType]}\nüìß Calendar invite sent to your email\nüí¨ Mentor will contact you within 24h`);
		};

		// Pair session joining
		window.joinPairSession = function(sessionId) {
			const sessions = [
				'Quest 1: Basic Move Syntax',
				'Quest 3: Resource Model', 
				'Custom DeFi Project'
			];
			
			document.getElementById('pairProgrammingModal').style.display = 'none';
			alert(`‚úÖ Joined "${sessions[sessionId-1]}" session!\n\nYou'll be matched with other developers shortly.\nDiscord invite sent!`);
		};

		// Modal close handlers
		document.getElementById('closeMentorship').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('mentorshipModal').style.display = 'none';
		});

		document.getElementById('closePairProgramming').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('pairProgrammingModal').style.display = 'none';
		});

		document.getElementById('viewHackathonsBtn').addEventListener('click', () => {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			
			// Show hackathon modal instead of prompt
			document.getElementById('hackathonModal').style.display = 'grid';
		});

		// Hackathon registration function
		window.registerHackathon = function(hackathonType) {
			const hackathons = {
				'defi': 'Move DeFi Challenge (Jan 15-17, 2025)',
				'nft': 'NFT Innovation Sprint (Jan 22-24, 2025)'
			};
			
			document.getElementById('hackathonModal').style.display = 'none';
			
			// Add activity to timeline
			addActivity('üèÜ', `Registered for ${hackathons[hackathonType]}`);
			
			alert(`üéâ Registered for ${hackathons[hackathonType]}!\n\n‚úÖ Registration confirmed\nüìß Details sent to your email\nüí¨ Discord invite coming soon`);
		};

		document.getElementById('viewSponsorPools').addEventListener('click', () => {
			alert('üí∞ Active Sponsor Pools:\n\nüè¶ Aptos Foundation - 1000 APT (65% distributed)\nüîä Decibel - 750 APT (45% distributed)\n‚ö° Shelby Protocol - 400 APT (30% distributed)\n\nScroll down to join pools!');
		});

		document.getElementById('leaderboardBtn').addEventListener('click', () => {
			loadLeaderboard();
			document.getElementById('leaderboardModal').style.display = 'grid';
		});

		document.getElementById('verifyRewards').addEventListener('click', () => {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			alert('‚úÖ Your Verified Rewards:\n\nQuest Completions: 0\nTotal Earned: 0 APT\nOn-Chain Transactions: 0\n\nComplete quests to start earning!');
		});

		// Global functions
		window.joinCollaboration = function(projectId) {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			alert(`‚úÖ Application sent for ${projectId}! Team lead will contact you via email.`);
		};

		window.joinSponsorPool = function(poolId) {
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			alert(`‚úÖ Joined ${poolId} sponsor pool! Start completing quests to earn rewards.`);
		};

		// Chart rendering
		function updateQuestChart() {
			const canvas = document.getElementById('questChart');
			if (!canvas) return;
			
			const ctx = canvas.getContext('2d');
			const width = canvas.width;
			const height = canvas.height;
			
			// Clear canvas
			ctx.fillStyle = '#0f0f0f';
			ctx.fillRect(0, 0, width, height);
			
			// Draw simple chart
			const data = [12, 19, 15, 25, 32, 28, 35];
			const maxValue = Math.max(...data);
			const barWidth = width / data.length;
			
			ctx.fillStyle = '#82ffa1';
			data.forEach((value, index) => {
				const barHeight = (value / maxValue) * (height - 20);
				const x = index * barWidth + 5;
				const y = height - barHeight - 10;
				ctx.fillRect(x, y, barWidth - 10, barHeight);
			});
		}

		// Animate number changes
		function animateNumber(elementId, targetValue) {
			const element = document.getElementById(elementId);
			if (!element) return;
			
			const currentValue = parseInt(element.textContent) || 0;
			const difference = targetValue - currentValue;
			const steps = 10;
			const stepValue = difference / steps;
			let currentStep = 0;
			
			const interval = setInterval(() => {
				currentStep++;
				const newValue = Math.round(currentValue + (stepValue * currentStep));
				element.textContent = newValue;
				
				// Add a subtle glow effect
				element.style.textShadow = '0 0 10px #82ffa1';
				setTimeout(() => {
					element.style.textShadow = 'none';
				}, 200);
				
				if (currentStep >= steps) {
					clearInterval(interval);
					element.textContent = targetValue;
				}
			}, 50);
		}

		// Update stats periodically
		function updateStats() {
			// Add some randomness to make it feel live
			const activeDevs = Math.floor(Math.random() * 20) + 120;
			const completedQuests = Math.floor(Math.random() * 30) + 80;
			const onChainTx = Math.floor(Math.random() * 50) + 140;
			
			// Animate the numbers
			animateNumber('activeDevelopers', activeDevs);
			animateNumber('completedQuests', completedQuests);
			animateNumber('onChainTx', onChainTx);
			
			// Update personal dashboard stats
			if (userProfile) {
				document.getElementById('userQuestsCompleted').textContent = userProfile.questsCompleted || 0;
				document.getElementById('userStreak').textContent = userProfile.streak || 0;
				document.getElementById('userLevel').textContent = Math.floor((userProfile.questsCompleted || 0) / 3) + 1;
				document.getElementById('userXP').textContent = (userProfile.questsCompleted || 0) * 100;
				document.getElementById('userFollowers').textContent = userProfile.followers ? userProfile.followers.length : 0;
				document.getElementById('userFollowing').textContent = userProfile.following ? userProfile.following.length : 0;
				
				// Update badges
				const badgesContainer = document.getElementById('userBadges');
				if (badgesContainer && userProfile.badges) {
					badgesContainer.innerHTML = userProfile.badges.map(badge => 
						`<span class="badge">${badge}</span>`
					).join('');
				}
				
				// Load quest history
				loadQuestHistory();
				
				// Load activity timeline
				loadActivityTimeline();
			}
		}

		// Enhanced social sharing function
		window.shareAchievement = function(questTitle) {
			const shareText = `üéâ Just completed "${questTitle}" on @movebuildershub!\n\nLearning Move programming on-chain üöÄ\n\nüîó Join me: https://movebuildershub.xyz\n\n#Move #Aptos #Web3Education #Blockchain`;
			
			if (navigator.share && isMobile()) {
				// Native mobile sharing
				navigator.share({ 
					title: 'Move Builders Hub Achievement', 
					text: shareText, 
					url: 'https://movebuildershub.xyz' 
				});
			} else {
				// Desktop: Show sharing options
				const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;
				const linkedInUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent('https://movebuildershub.xyz')}&summary=${encodeURIComponent(shareText)}`;
				
				const choice = confirm(`üì§ Share "${questTitle}" Achievement!\n\nClick OK for X (Twitter)\nClick Cancel to copy text for manual sharing`);
				
				if (choice) {
					// Open X (Twitter)
					window.open(twitterUrl, '_blank', 'width=600,height=400');
				} else {
					// Copy to clipboard + show more options
					navigator.clipboard.writeText(shareText).then(() => {
						const moreOptions = confirm(`üìã Text copied to clipboard!\n\nClick OK to open LinkedIn sharing\nClick Cancel to share manually`);
						
						if (moreOptions) {
							window.open(linkedInUrl, '_blank', 'width=600,height=400');
						}
					});
				}
			}
		};

		// Achievement system
		function awardAchievements(questId) {
			if (!userProfile) return;
			
			const newBadges = [];
			userProfile.questsCompleted = (userProfile.questsCompleted || 0) + 1;
			userProfile.streak = (userProfile.streak || 0) + 1;
			
			// Milestone badges
			if (userProfile.questsCompleted === 1) newBadges.push('First Quest');
			if (userProfile.questsCompleted === 3) newBadges.push('Getting Started');
			if (userProfile.questsCompleted === 6) newBadges.push('Quest Master');
			if (userProfile.streak === 3) newBadges.push('On Fire');
			
			// Quest-specific badges
			if (questId === 3) newBadges.push('Security Expert');
			if (questId === 5) newBadges.push('Module Architect');
			
			newBadges.forEach(badge => {
				if (!userProfile.badges) userProfile.badges = ['New Builder'];
				if (!userProfile.badges.includes(badge)) {
					userProfile.badges.push(badge);
				}
			});
			
			localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
			
			if (newBadges.length > 0) {
				setTimeout(() => {
					alert(`üèÜ New Achievement!\n\nBadges earned: ${newBadges.join(', ')}\n\nTotal quests: ${userProfile.questsCompleted}\nStreak: ${userProfile.streak} days`);
				}, 2000);
			}
		}

		// Enhanced quest completion with sharing and achievements
		function completeQuestWithSharing(questId, questTitle) {
			// Award achievements first
			awardAchievements(questId);
			
			// Add to quest history
			addQuestToHistory(questTitle, 100);
			
			// Add activity to timeline
			addActivity('üéØ', `Completed quest: ${questTitle}`);
			
			alert(`üéâ Quest "${questTitle}" completed!\n\n‚úÖ Reward earned\n‚õìÔ∏è Recorded on-chain`);
			
			setTimeout(() => {
				const share = confirm('üì§ Share your achievement on social media?');
				if (share) {
					shareAchievement(questTitle);
				}
			}, 1000);
		}

		// Daily streaks system
		function checkDailyLogin() {
			if (!userProfile) return;
			
			const today = new Date().toDateString();
			const lastLogin = userProfile.lastLogin;
			
			if (lastLogin !== today) {
				const yesterday = new Date();
				yesterday.setDate(yesterday.getDate() - 1);
				
				if (lastLogin === yesterday.toDateString()) {
					// Consecutive day
					userProfile.streak = (userProfile.streak || 0) + 1;
					
					if (userProfile.streak % 7 === 0) {
						alert(`üî• ${userProfile.streak} Day Streak!\n\nBonus: +50 XP\nKeep the momentum going!`);
						userProfile.xp = (userProfile.xp || 0) + 50;
					}
				} else {
					// Streak broken
					if (userProfile.streak > 0) {
						alert(`üìÖ Welcome back!\n\nPrevious streak: ${userProfile.streak} days\nStarting fresh today!`);
					}
					userProfile.streak = 1;
				}
				
				userProfile.lastLogin = today;
				localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
			}
		}

		// Push notifications setup
		async function setupPushNotifications() {
			if ('serviceWorker' in navigator && 'PushManager' in window) {
				try {
					// Register service worker
					const registration = await navigator.serviceWorker.register('/sw.js');
					console.log('‚úÖ Service Worker registered');
					
					// Request notification permission
					const permission = await Notification.requestPermission();
					if (permission === 'granted') {
						notificationPermission = true;
						console.log('‚úÖ Notification permission granted');
						
						// Schedule daily reminder
						scheduleQuestReminder();
					}
				} catch (error) {
					console.log('‚ùå Push notifications not supported');
				}
			}
		}

		function scheduleQuestReminder() {
			if (!notificationPermission) return;
			
			// Daily reminder at 6 PM
			const now = new Date();
			const reminderTime = new Date();
			reminderTime.setHours(18, 0, 0, 0);
			
			if (reminderTime < now) {
				reminderTime.setDate(reminderTime.getDate() + 1);
			}
			
			const timeUntilReminder = reminderTime.getTime() - now.getTime();
			
			setTimeout(() => {
				if (Notification.permission === 'granted') {
					new Notification('üéØ Daily Quest Reminder', {
						body: 'Complete a quest to maintain your streak!',
						icon: '/logo.png',
						badge: '/logo.png'
					});
				}
				
				// Schedule next day
				scheduleQuestReminder();
			}, timeUntilReminder);
		}

		// Input validation and security
		function validateInput(input, type) {
			if (type === 'username') {
				return input.length >= 3 && input.length <= 20 && /^[a-zA-Z0-9_-]+$/.test(input);
			}
			if (type === 'bio') {
				return input.length <= 200;
			}
			return true;
		}

		// Initialize charts and stats
		setTimeout(() => {
			updateQuestChart();
			updateStats();
			setInterval(updateStats, 30000); // Update every 30 seconds
			
			// Show referral link if connected
			if (walletConnected) {
				document.getElementById('referralSection').style.display = 'block';
			}
		}, 1000);

		// Personal dashboard functionality
		document.getElementById('myDashboard').addEventListener('click', () => {
			if (!walletConnected || !userProfile) {
				alert('Please connect wallet and create profile first!');
				return;
			}
			
			// Update dashboard data
			document.getElementById('userQuestsCompleted').textContent = userProfile.questsCompleted || 0;
			document.getElementById('userStreak').textContent = userProfile.streak || 0;
			document.getElementById('userLevel').textContent = Math.floor((userProfile.questsCompleted || 0) / 2) + 1;
			document.getElementById('userXP').textContent = (userProfile.questsCompleted || 0) * 100 + (userProfile.xp || 0);
			
			// Show badges
			const badgesDiv = document.getElementById('userBadges');
			badgesDiv.innerHTML = (userProfile.badges || []).map(badge => `<span class="chip">${badge}</span>`).join('');
			
			document.getElementById('personalDashboardModal').style.display = 'grid';
		});

		// Code editor functionality
		document.getElementById('viewStats').addEventListener('click', () => {
			document.getElementById('codeEditorModal').style.display = 'grid';
		});

		// Code templates
		window.loadTemplate = function(type) {
			const editor = document.getElementById('moveCodeEditor');
			const templates = {
				basic: `module 0x1::basic_example {
    public fun add(a: u64, b: u64): u64 {
        a + b
    }
    
    public fun greet(name: vector<u8>): vector<u8> {
        b"Hello, " + name + b"!"
    }
}`,
				coin: `module 0x1::my_coin {
    struct Coin has store {
        value: u64,
    }
    
    public fun mint(amount: u64): Coin {
        Coin { value: amount }
    }
    
    public fun burn(coin: Coin): u64 {
        let Coin { value } = coin;
        value
    }
}`,
				defi: `module 0x1::simple_pool {
    struct Pool has key {
        token_a: u64,
        token_b: u64,
        shares: u64,
    }
    
    public entry fun create_pool(
        account: &signer,
        amount_a: u64,
        amount_b: u64
    ) {
        move_to(account, Pool {
            token_a: amount_a,
            token_b: amount_b,
            shares: 1000,
        });
    }
}`
			};
			
			editor.value = templates[type];
		};

		// Run Move code (simulation)
		window.runMoveCode = function() {
			const code = document.getElementById('moveCodeEditor').value;
			const output = document.getElementById('codeOutput');
			
			output.innerHTML = '<div class="spinner"></div> Compiling Move code...';
			
			setTimeout(() => {
				if (code.includes('syntax error') || code.includes('error')) {
					output.innerHTML = '<div style="color:#ff6b6b;">‚ùå Compilation Error: Check your syntax</div>';
				} else {
					output.innerHTML = `<div style="color:#82ffa1;">‚úÖ Compilation Successful!</div>
					<div style="margin-top:8px; color:#cfcfcf;">
						‚Ä¢ Module compiled successfully<br>
						‚Ä¢ Functions validated<br>
						‚Ä¢ Ready for deployment to Aptos testnet
					</div>`;
				}
			}, 2000);
		};

		// Modal close handlers
		document.getElementById('closeDashboard').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('personalDashboardModal').style.display = 'none';
		});

		document.getElementById('closeCodeEditor').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('codeEditorModal').style.display = 'none';
		});

		document.getElementById('closeHackathon').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('hackathonModal').style.display = 'none';
		});

		document.getElementById('connectWallet').addEventListener('click', connectWallet);
		document.getElementById('disconnectWallet').addEventListener('click', disconnectWallet);

		// New Profile Functions
		window.loadQuestHistory = function() {
			if (!userProfile) return;
			
			const questHistory = userProfile.questHistory || [];
			const container = document.getElementById('questHistory');
			if (!container) return;
			
			if (questHistory.length === 0) {
				container.innerHTML = '<p style="color:#8a8a8a; text-align:center; margin:0;">No quests completed yet. Start your journey!</p>';
				return;
			}
			
			container.innerHTML = questHistory.map(quest => `
				<div style="display:flex; justify-content:space-between; align-items:center; padding:8px; border:1px solid #333; border-radius:6px; background:#0f0f0f;">
					<div>
						<strong>${quest.title}</strong>
						<div style="font-size:12px; color:#8a8a8a;">Completed ${new Date(quest.completedAt).toLocaleDateString()}</div>
					</div>
					<div style="color:#82ffa1; font-weight:bold;">+${quest.xp || 100} XP</div>
				</div>
			`).join('');
		};

		window.loadActivityTimeline = function() {
			if (!userProfile) return;
			
			const activities = userProfile.activities || [];
			const container = document.getElementById('activityTimeline');
			if (!container) return;
			
			if (activities.length === 0) {
				container.innerHTML = '<p style="color:#8a8a8a; text-align:center; margin:0;">No recent activity. Start exploring!</p>';
				return;
			}
			
			container.innerHTML = activities.slice(0, 10).map(activity => `
				<div style="display:flex; align-items:center; gap:12px; padding:8px; border:1px solid #333; border-radius:6px; background:#0f0f0f;">
					<div style="font-size:20px;">${activity.icon}</div>
					<div style="flex:1;">
						<div>${activity.description}</div>
						<div style="font-size:12px; color:#8a8a8a;">${new Date(activity.timestamp).toLocaleString()}</div>
					</div>
				</div>
			`).join('');
		};

		window.editProfile = function() {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			// Pre-fill the form with existing data
			document.getElementById('usernameInput').value = userProfile.username || '';
			document.getElementById('bioInput').value = userProfile.bio || '';
			document.getElementById('emailInput').value = userProfile.email || '';
			document.getElementById('experienceInput').value = userProfile.experience || 'beginner';
			
			// Pre-fill social links
			document.getElementById('twitterInput').value = userProfile.socialLinks?.twitter || '';
			document.getElementById('githubInput').value = userProfile.socialLinks?.github || '';
			document.getElementById('linkedinInput').value = userProfile.socialLinks?.linkedin || '';
			
			// Set privacy setting
			const privacyRadios = document.querySelectorAll('input[name="privacy"]');
			privacyRadios.forEach(radio => {
				radio.checked = radio.value === (userProfile.privacy || 'public');
			});
			
			// Set skills
			const skillCheckboxes = document.querySelectorAll('.skill-checkbox input[type="checkbox"]');
			skillCheckboxes.forEach(checkbox => {
				checkbox.checked = userProfile.skills && userProfile.skills.includes(checkbox.value);
			});
			
			// Set avatar
			if (userProfile.avatar) {
				selectAvatar(userProfile.avatar);
			}
			
			document.getElementById('createProfileModal').style.display = 'grid';
		};

		window.viewPublicProfile = function() {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			if (userProfile.privacy === 'private') {
				alert('Your profile is set to private. Change privacy settings to make it public.');
				return;
			}
			
			// Load public profile content
			const content = document.getElementById('publicProfileContent');
			content.innerHTML = `
				<div style="text-align:center; margin-bottom:20px;">
					<div style="font-size:48px; margin-bottom:8px;">${userProfile.avatar}</div>
					<h3 style="margin:0;">${userProfile.username}</h3>
					<p style="color:#8a8a8a; margin:4px 0;">${userProfile.bio}</p>
					<div style="display:flex; gap:8px; justify-content:center; margin:8px 0;">
						<span class="badge">${userProfile.experience}</span>
						${userProfile.skills ? userProfile.skills.map(skill => `<span class="badge">${skill}</span>`).join('') : ''}
					</div>
					${userProfile.socialLinks && Object.keys(userProfile.socialLinks).length > 0 ? `
						<div style="display:flex; gap:12px; justify-content:center; margin:12px 0;">
							${userProfile.socialLinks.twitter ? `<a href="https://twitter.com/${userProfile.socialLinks.twitter.replace('@', '')}" target="_blank" style="color:#82ffa1; text-decoration:none; font-size:20px;" title="X (Twitter)">üê¶</a>` : ''}
							${userProfile.socialLinks.github ? `<a href="https://github.com/${userProfile.socialLinks.github}" target="_blank" style="color:#82ffa1; text-decoration:none; font-size:20px;" title="GitHub">üíª</a>` : ''}
							${userProfile.socialLinks.linkedin ? `<a href="https://${userProfile.socialLinks.linkedin}" target="_blank" style="color:#82ffa1; text-decoration:none; font-size:20px;" title="LinkedIn">üíº</a>` : ''}
						</div>
					` : ''}
				</div>
				
				<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px; margin:16px 0;">
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px;">
						<div style="font-size:20px; font-weight:bold; color:#82ffa1;">${userProfile.questsCompleted || 0}</div>
						<div style="font-size:12px; color:#8a8a8a;">Quests</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px;">
						<div style="font-size:20px; font-weight:bold; color:#82ffa1;">${userProfile.streak || 0}</div>
						<div style="font-size:12px; color:#8a8a8a;">Streak</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px;">
						<div style="font-size:20px; font-weight:bold; color:#82ffa1;">${userProfile.followers ? userProfile.followers.length : 0}</div>
						<div style="font-size:12px; color:#8a8a8a;">Followers</div>
					</div>
					<div style="text-align:center; padding:12px; border:1px solid #333; border-radius:8px;">
						<div style="font-size:20px; font-weight:bold; color:#82ffa1;">${userProfile.following ? userProfile.following.length : 0}</div>
						<div style="font-size:12px; color:#8a8a8a;">Following</div>
					</div>
				</div>
				
				<h4>üèÜ Achievements</h4>
				<div class="chips">
					${userProfile.badges ? userProfile.badges.map(badge => `<span class="badge">${badge}</span>`).join('') : '<span class="badge">New Builder</span>'}
				</div>
			`;
			
			document.getElementById('publicProfileModal').style.display = 'grid';
		};

		window.shareProfile = function() {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			const profileUrl = userProfile.profileLink || `https://movebuildershub.xyz/profile/${userProfile.username}`;
			const shareText = `üë§ Check out my Move Builders Hub profile!\n\n${userProfile.username} - ${userProfile.bio}\n\nüèÜ ${userProfile.questsCompleted || 0} quests completed\nüî• ${userProfile.streak || 0} day streak\n\nüîó ${profileUrl}\n\n#MoveBuildersHub #Aptos #Web3Education`;
			
			if (navigator.share && isMobile()) {
				navigator.share({
					title: `${userProfile.username} - Move Builders Hub Profile`,
					text: shareText,
					url: profileUrl
				});
			} else {
				navigator.clipboard.writeText(shareText).then(() => {
					alert('üìã Profile link copied to clipboard!\n\nShare it with your friends!');
				});
			}
		};

		window.toggleFollow = function() {
			// This would be implemented with backend integration
			alert('Follow functionality will be available with backend integration!');
		};

		window.followUser = function(userHandle) {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			if (!userProfile.following) userProfile.following = [];
			
			if (userProfile.following.includes(userHandle)) {
				// Unfollow
				userProfile.following = userProfile.following.filter(u => u !== userHandle);
				addActivity('üë•', `Unfollowed @${userHandle}`);
				alert(`üëã Unfollowed @${userHandle}`);
			} else {
				// Follow
				userProfile.following.push(userHandle);
				addActivity('üë•', `Followed @${userHandle}`);
				alert(`‚úÖ Following @${userHandle}!\n\nYou'll see their updates in your activity feed.`);
			}
			
			// Save to localStorage
			localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
			
			// Update UI
			updateStats();
		};

		// Close public profile modal
		document.getElementById('closePublicProfile').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('publicProfileModal').style.display = 'none';
		});

		document.getElementById('publicProfileModal').addEventListener('click', (e) => {
			if (e.target.id === 'publicProfileModal') {
				document.getElementById('publicProfileModal').style.display = 'none';
			}
		});

		// Add activity to timeline
		window.addActivity = function(icon, description) {
			if (!userProfile) return;
			
			if (!userProfile.activities) userProfile.activities = [];
			
			userProfile.activities.unshift({
				icon: icon,
				description: description,
				timestamp: new Date().toISOString()
			});
			
			// Keep only last 50 activities
			userProfile.activities = userProfile.activities.slice(0, 50);
			
			// Save to localStorage
			localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
		};

		// Add quest to history
		window.addQuestToHistory = function(questTitle, xp = 100) {
			if (!userProfile) return;
			
			if (!userProfile.questHistory) userProfile.questHistory = [];
			
			userProfile.questHistory.unshift({
				title: questTitle,
				completedAt: new Date().toISOString(),
				xp: xp
			});
			
			// Keep only last 100 quests
			userProfile.questHistory = userProfile.questHistory.slice(0, 100);
			
			// Save to localStorage
			localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
		};

		// Activity Feed Functions
		window.openActivityFeed = function() {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			loadActivityFeed();
			document.getElementById('activityFeedModal').style.display = 'grid';
		};

		// Quest Progress Functions
		window.openQuestProgress = function() {
			loadQuestProgress();
			document.getElementById('questProgressModal').style.display = 'grid';
		};

		// Messaging System Functions
		window.openChat = function(userHandle, userName) {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			if (!walletConnected) {
				alert('Please connect your wallet first!');
				return;
			}
			
			currentChatUser = userHandle;
			document.getElementById('chatTitle').textContent = `üí¨ Chat with ${userName}`;
			
			// Load gas fee
			updateGasFee();
			
			// Load messages
			loadMessages();
			
			document.getElementById('chatModal').style.display = 'grid';
		};

		window.updateGasFee = async function() {
			try {
				// Simulate network status check
				const networkStatus = Math.random();
				let status, fee, time;
				
				if (networkStatus < 0.3) {
					status = 'Low';
					fee = 0.0005;
					time = '~2s';
				} else if (networkStatus < 0.7) {
					status = 'Normal';
					fee = 0.001;
					time = '~5s';
				} else if (networkStatus < 0.9) {
					status = 'High';
					fee = 0.002;
					time = '~10s';
				} else {
					status = 'Very High';
					fee = 0.005;
					time = '~30s';
				}
				
				gasFee = fee;
				document.getElementById('chatGasInfo').textContent = `Gas Fee: ${fee} APT (${status})`;
				document.getElementById('gasFeeDisplay').textContent = `Gas: ${fee} APT`;
				document.getElementById('networkStatus').textContent = `Network: ${status}`;
				
			} catch (error) {
				console.error('Error updating gas fee:', error);
				document.getElementById('chatGasInfo').textContent = 'Gas Fee: 0.001 APT (Default)';
			}
		};

		window.loadMessages = function() {
			if (!currentChatUser) return;
			
			// Load messages from localStorage
			const chatKey = `chat_${walletAddress}_${currentChatUser}`;
			const storedMessages = localStorage.getItem(chatKey);
			messages = storedMessages ? JSON.parse(storedMessages) : [];
			
			// Display messages
			const container = document.getElementById('chatMessages');
			if (messages.length === 0) {
				container.innerHTML = '<p style="text-align:center; color:#8a8a8a; margin:20px 0;">No messages yet. Start the conversation!</p>';
			} else {
				container.innerHTML = messages.map(msg => `
					<div style="display:flex; ${msg.sender === userProfile.username ? 'justify-content:flex-end' : 'justify-content:flex-start'}; margin-bottom:12px;">
						<div style="max-width:70%; padding:8px 12px; border-radius:12px; background:${msg.sender === userProfile.username ? '#82ffa1' : '#333'}; color:${msg.sender === userProfile.username ? '#000' : '#fff'};">
							<div style="font-size:12px; opacity:0.7; margin-bottom:4px;">${msg.sender}</div>
							<div>${msg.content}</div>
							<div style="font-size:10px; opacity:0.6; margin-top:4px;">${new Date(msg.timestamp).toLocaleTimeString()}</div>
						</div>
					</div>
				`).join('');
			}
			
			// Update message count
			document.getElementById('messageCount').textContent = `${messages.length} messages`;
			
			// Scroll to bottom
			container.scrollTop = container.scrollHeight;
		};

		window.sendMessage = async function() {
			const messageInput = document.getElementById('messageInput');
			const content = messageInput.value.trim();
			
			if (!content) return;
			if (!currentChatUser) return;
			if (!userProfile) return;
			
			// Show loading state
			const sendBtn = document.getElementById('sendMessageBtn');
			sendBtn.innerHTML = '‚è≥ Sending...';
			sendBtn.disabled = true;
			
			try {
				// Simulate transaction
				await simulateMessageTransaction(content);
				
				// Add message to local storage
				const newMessage = {
					id: Date.now(),
					sender: userProfile.username,
					content: content,
					timestamp: new Date().toISOString(),
					gasFee: gasFee,
					recipient: currentChatUser
				};
				
				messages.push(newMessage);
				const chatKey = `chat_${walletAddress}_${currentChatUser}`;
				localStorage.setItem(chatKey, JSON.stringify(messages));
				
				// Clear input and reload messages
				messageInput.value = '';
				loadMessages();
				
				// Add activity
				addActivity('üí¨', `Sent message to @${currentChatUser}`);
				
				// Update gas fee for next message
				updateGasFee();
				
			} catch (error) {
				console.error('Error sending message:', error);
				alert('Failed to send message. Please try again.');
			} finally {
				sendBtn.innerHTML = 'Send';
				sendBtn.disabled = false;
			}
		};

		window.simulateMessageTransaction = async function(content) {
			// Simulate wallet transaction
			return new Promise((resolve, reject) => {
				setTimeout(() => {
					// Simulate 90% success rate
					if (Math.random() > 0.1) {
						resolve();
					} else {
						reject(new Error('Transaction failed'));
					}
				}, 2000);
			});
		};

		// Close chat modal
		document.getElementById('closeChat').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('chatModal').style.display = 'none';
			currentChatUser = null;
		});

		document.getElementById('chatModal').addEventListener('click', (e) => {
			if (e.target.id === 'chatModal') {
				document.getElementById('chatModal').style.display = 'none';
				currentChatUser = null;
			}
		});

		// Enter key to send message
		document.addEventListener('keypress', (e) => {
			if (e.key === 'Enter' && document.getElementById('messageInput') === document.activeElement) {
				sendMessage();
			}
		});

		window.loadActivityFeed = function() {
			if (!userProfile) return;
			
			const container = document.getElementById('activityFeedContent');
			if (!container) return;
			
			// Get all activities from following users (simulated)
			const allActivities = userProfile.activities || [];
			const followingActivities = [];
			
			// Simulate activities from followed users
			if (userProfile.following && userProfile.following.length > 0) {
				userProfile.following.forEach(userHandle => {
					// Simulate some activities from followed users
					followingActivities.push({
						user: userHandle,
						icon: 'üéØ',
						description: `Completed quest: Move Basics`,
						timestamp: new Date(Date.now() - Math.random() * 86400000).toISOString()
					});
					followingActivities.push({
						user: userHandle,
						icon: 'üèÜ',
						description: `Registered for Move DeFi Challenge`,
						timestamp: new Date(Date.now() - Math.random() * 172800000).toISOString()
					});
				});
			}
			
			// Combine and sort all activities
			const combinedActivities = [...allActivities, ...followingActivities]
				.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
				.slice(0, 20);
			
			if (combinedActivities.length === 0) {
				container.innerHTML = '<p style="color:#8a8a8a; text-align:center; margin:20px 0;">No recent activity. Start following other builders!</p>';
				return;
			}
			
			container.innerHTML = combinedActivities.map(activity => `
				<div style="display:flex; align-items:center; gap:12px; padding:12px; border:1px solid #333; border-radius:8px; background:#0f0f0f; margin-bottom:8px;">
					<div style="font-size:24px;">${activity.icon}</div>
					<div style="flex:1;">
						<div>
							${activity.user ? `<strong>@${activity.user}</strong> ` : ''}${activity.description}
						</div>
						<div style="font-size:12px; color:#8a8a8a; margin-top:4px;">
							${new Date(activity.timestamp).toLocaleString()}
						</div>
					</div>
				</div>
			`).join('');
		};

		// Close activity feed modal
		document.getElementById('closeActivityFeed').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('activityFeedModal').style.display = 'none';
		});

		document.getElementById('activityFeedModal').addEventListener('click', (e) => {
			if (e.target.id === 'activityFeedModal') {
				document.getElementById('activityFeedModal').style.display = 'none';
			}
		});

		// Live Leaderboard Functions
		let autoRefreshInterval = null;
		let autoRefreshEnabled = false;
		let dashboardAutoRefreshInterval = null;
		let dashboardAutoRefreshEnabled = false;
		let questProgressAutoRefreshInterval = null;
		let questProgressAutoRefreshEnabled = false;
		let currentChatUser = null;
		let messages = [];
		let gasFee = 0.001;

		window.loadLeaderboard = function() {
			const container = document.getElementById('leaderboardContent');
			if (!container) return;
			
			// Simulate live leaderboard data with some randomness
			const leaderboardData = [
				{ rank: 1, username: '@nese', quests: 35 + Math.floor(Math.random() * 3), apt: 1.4 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 2, username: '@dilek', quests: 29 + Math.floor(Math.random() * 3), apt: 1.1 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 3, username: '@selina', quests: 22 + Math.floor(Math.random() * 3), apt: 0.7 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 4, username: '@deniz', quests: 20 + Math.floor(Math.random() * 3), apt: 0.6 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 5, username: '@efecan', quests: 18 + Math.floor(Math.random() * 3), apt: 0.5 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 6, username: '@okant', quests: 14 + Math.floor(Math.random() * 3), apt: 0.4 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 7, username: '@newuser1', quests: 12 + Math.floor(Math.random() * 3), apt: 0.3 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' },
				{ rank: 8, username: '@newuser2', quests: 10 + Math.floor(Math.random() * 3), apt: 0.2 + (Math.random() * 0.2).toFixed(1), change: Math.random() > 0.5 ? '‚ÜóÔ∏è' : '‚Üí' }
			];
			
			container.innerHTML = `
				<div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:16px;">
					<div style="display:grid; gap:8px;">
						${leaderboardData.map(user => `
							<div style="display:flex; align-items:center; gap:12px; padding:12px; border:1px solid #333; border-radius:6px; background:#0f0f0f; transition: all 0.3s ease;">
								<div style="font-size:20px; font-weight:bold; color:#82ffa1; min-width:30px;">
									${user.rank === 1 ? 'ü•á' : user.rank === 2 ? 'ü•à' : user.rank === 3 ? 'ü•â' : `#${user.rank}`}
								</div>
								<div style="flex:1;">
									<div style="font-weight:bold;">${user.username}</div>
									<div style="font-size:12px; color:#8a8a8a;">${user.quests} quests ‚Ä¢ ${user.apt} APT</div>
								</div>
								<div style="font-size:16px;" title="Trend">${user.change}</div>
							</div>
						`).join('')}
					</div>
					<div style="text-align:center; margin-top:16px; color:#8a8a8a; font-size:12px;">
						Last updated: ${new Date().toLocaleTimeString()}
					</div>
				</div>
			`;
		};

		window.refreshLeaderboard = function() {
			const btn = document.getElementById('refreshLeaderboardBtn');
			btn.innerHTML = '‚è≥ Refreshing...';
			btn.disabled = true;
			
			setTimeout(() => {
				loadLeaderboard();
				btn.innerHTML = 'üîÑ Refresh';
				btn.disabled = false;
			}, 1000);
		};

		// Dashboard Auto-Refresh Functions
		window.toggleDashboardAutoRefresh = function() {
			const btn = document.getElementById('dashboardAutoRefreshBtn');
			
			if (dashboardAutoRefreshEnabled) {
				// Disable auto refresh
				clearInterval(dashboardAutoRefreshInterval);
				dashboardAutoRefreshEnabled = false;
				btn.innerHTML = 'üîÑ Auto Refresh: OFF';
				btn.style.background = 'transparent';
			} else {
				// Enable auto refresh
				dashboardAutoRefreshInterval = setInterval(() => {
					updateStats();
					loadQuestHistory();
					loadActivityTimeline();
				}, 10000); // Refresh every 10 seconds
				dashboardAutoRefreshEnabled = true;
				btn.innerHTML = 'üîÑ Auto Refresh: ON';
				btn.style.background = '#82ffa1';
				btn.style.color = '#000';
			}
		};

		window.toggleAutoRefresh = function() {
			const btn = document.getElementById('autoRefreshBtn');
			
			if (autoRefreshEnabled) {
				// Disable auto refresh
				clearInterval(autoRefreshInterval);
				autoRefreshEnabled = false;
				btn.innerHTML = '‚è∞ Auto Refresh: OFF';
				btn.style.background = 'transparent';
			} else {
				// Enable auto refresh
				autoRefreshInterval = setInterval(() => {
					loadLeaderboard();
				}, 5000); // Refresh every 5 seconds
				autoRefreshEnabled = true;
				btn.innerHTML = '‚è∞ Auto Refresh: ON';
				btn.style.background = '#82ffa1';
				btn.style.color = '#000';
			}
		};

		// Close leaderboard modal
		document.getElementById('closeLeaderboard').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('leaderboardModal').style.display = 'none';
			// Stop auto refresh when modal closes
			if (autoRefreshEnabled) {
				toggleAutoRefresh();
			}
		});

		document.getElementById('leaderboardModal').addEventListener('click', (e) => {
			if (e.target.id === 'leaderboardModal') {
				document.getElementById('leaderboardModal').style.display = 'none';
				// Stop auto refresh when modal closes
				if (autoRefreshEnabled) {
					toggleAutoRefresh();
				}
			}
		});

		// Live Quest Progress Functions
		window.loadQuestProgress = function() {
			const container = document.getElementById('questProgressContent');
			if (!container) return;
			
			// Simulate live quest progress data
			const questProgressData = [
				{ quest: 'Move Basics', users: 45, completed: 32, inProgress: 13, completionRate: 71 },
				{ quest: 'Smart Contracts', users: 38, completed: 28, inProgress: 10, completionRate: 74 },
				{ quest: 'DeFi Protocols', users: 29, completed: 18, inProgress: 11, completionRate: 62 },
				{ quest: 'NFT Development', users: 22, completed: 15, inProgress: 7, completionRate: 68 },
				{ quest: 'Testing & Security', users: 19, completed: 12, inProgress: 7, completionRate: 63 },
				{ quest: 'Advanced Move', users: 15, completed: 8, inProgress: 7, completionRate: 53 }
			];
			
			container.innerHTML = `
				<div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:16px;">
					<div style="display:grid; gap:12px;">
						${questProgressData.map(quest => `
							<div style="border:1px solid #333; border-radius:8px; padding:16px; background:#0f0f0f;">
								<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
									<h4 style="margin:0; color:#82ffa1;">${quest.quest}</h4>
									<span style="color:#8a8a8a; font-size:12px;">${quest.completionRate}% completion</span>
								</div>
								<div style="background:#1a1a1a; border-radius:4px; height:8px; margin-bottom:8px;">
									<div style="background:#82ffa1; height:100%; border-radius:4px; width:${quest.completionRate}%; transition: width 0.5s ease;"></div>
								</div>
								<div style="display:flex; justify-content:space-between; font-size:12px; color:#8a8a8a;">
									<span>üë• ${quest.users} users</span>
									<span>‚úÖ ${quest.completed} completed</span>
									<span>üîÑ ${quest.inProgress} in progress</span>
								</div>
							</div>
						`).join('')}
					</div>
					<div style="text-align:center; margin-top:16px; color:#8a8a8a; font-size:12px;">
						Last updated: ${new Date().toLocaleTimeString()}
					</div>
				</div>
			`;
		};

		window.refreshQuestProgress = function() {
			const btn = document.getElementById('refreshQuestProgressBtn');
			btn.innerHTML = '‚è≥ Refreshing...';
			btn.disabled = true;
			
			setTimeout(() => {
				loadQuestProgress();
				btn.innerHTML = 'üîÑ Refresh';
				btn.disabled = false;
			}, 1000);
		};

		window.toggleQuestProgressAutoRefresh = function() {
			const btn = document.getElementById('questProgressAutoRefreshBtn');
			
			if (questProgressAutoRefreshEnabled) {
				// Disable auto refresh
				clearInterval(questProgressAutoRefreshInterval);
				questProgressAutoRefreshEnabled = false;
				btn.innerHTML = '‚è∞ Auto Refresh: OFF';
				btn.style.background = 'transparent';
			} else {
				// Enable auto refresh
				questProgressAutoRefreshInterval = setInterval(() => {
					loadQuestProgress();
				}, 8000); // Refresh every 8 seconds
				questProgressAutoRefreshEnabled = true;
				btn.innerHTML = '‚è∞ Auto Refresh: ON';
				btn.style.background = '#82ffa1';
				btn.style.color = '#000';
			}
		};

		// Close quest progress modal
		document.getElementById('closeQuestProgress').addEventListener('click', (e) => {
			e.preventDefault();
			document.getElementById('questProgressModal').style.display = 'none';
			// Stop auto refresh when modal closes
			if (questProgressAutoRefreshEnabled) {
				toggleQuestProgressAutoRefresh();
			}
		});

		document.getElementById('questProgressModal').addEventListener('click', (e) => {
			if (e.target.id === 'questProgressModal') {
				document.getElementById('questProgressModal').style.display = 'none';
				// Stop auto refresh when modal closes
				if (questProgressAutoRefreshEnabled) {
					toggleQuestProgressAutoRefresh();
				}
			}
		});

		// Like/React System Functions
		window.likeQuest = function(questId, reaction) {
			if (!userProfile) {
				alert('Please create a profile first!');
				return;
			}
			
			// Get current quest data
			const quest = quests.find(q => q.id === questId);
			if (!quest) return;
			
			// Initialize reaction counts if not exist
			if (!quest.likes) quest.likes = 0;
			if (!quest.fire) quest.fire = 0;
			if (!quest.rocket) quest.rocket = 0;
			
			// Update reaction count
			if (reaction === '‚ù§Ô∏è') {
				quest.likes++;
				document.getElementById(`likes-${questId}`).textContent = quest.likes;
			} else if (reaction === 'üî•') {
				quest.fire++;
				document.getElementById(`fire-${questId}`).textContent = quest.fire;
			} else if (reaction === 'üöÄ') {
				quest.rocket++;
				document.getElementById(`rocket-${questId}`).textContent = quest.rocket;
			}
			
			// Add activity to timeline
			addActivity('üëç', `Reacted ${reaction} to quest: ${quest.title}`);
			
			// Show feedback
			const button = event.target.closest('button');
			button.style.background = '#82ffa1';
			button.style.color = '#000';
			setTimeout(() => {
				button.style.background = 'transparent';
				button.style.color = '#fff';
			}, 1000);
		};

	})();
	</script>
</body>
</html>
