<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Move Builders Hub ‚Ä¢ On-Chain Move Learning</title>
	<meta name="color-scheme" content="dark light" />
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
	
	<!-- PWA Meta Tags -->
	<meta name="theme-color" content="#82ffa1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="Move Builders Hub">
	<link rel="manifest" href="manifest.json">
	<link rel="apple-touch-icon" href="logo.png">
	<style>
		:root { color-scheme: dark; }
		html, body { height: 100%; }
		* { box-sizing: border-box; }
		body {
			margin: 0;
			font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
			background: #000;
			color: #fff;
		}
		.container { width: min(1200px, 92vw); margin: 0 auto; padding: 20px; }
		.header { display: grid; gap: 8px; text-align: center; padding: 10px 0 20px; }
		
		/* Logo section */
		.logo-section { display: flex; flex-direction: column; align-items: center; gap: 2px; }
		.main-logo { 
			width: 160px; 
			height: auto; 
			max-width: 100%; 
			margin-bottom: -12px;
		}
		
		h1 { font-size: clamp(28px, 4vw, 40px); margin: 0; }
		.subtitle { color: #bdbdbd; margin: 0 auto; max-width: 800px; }
		.badges { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 8px; }
		.badge { padding: 6px 12px; border-radius: 999px; border: 1px solid #2a2a2a; background:#0f0f0f; font-size: 12px; color:#e5e5e5; }
		.ctaRow { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top: 14px; }
		.btn { appearance:none; border:1px solid #fff; background:#fff; color:#000; padding:12px 16px; border-radius:10px; font-weight:600; cursor:pointer; }
		.btn.secondary { background:transparent; color:#fff; border-color:#fff; }
		.note { color:#ffd788; font-size: 12px; margin-top: 6px; }
		.divider { height:1px; background:#1f1f1f; margin: 24px 0; }

		.grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); }
		.card { background:#0f0f0f; border:1px solid #222; border-radius:14px; padding:18px; position:relative; }
		.card h3 { margin:0 0 8px 0; font-size:18px; }
		.card p { margin:0; color:#cfcfcf; line-height:1.5; }

		/* Clickable card styles */
		.clickable-card { 
			cursor: pointer; 
			transition: all 0.2s ease;
			border: 1px solid #222;
		}
		.clickable-card:hover { 
			border-color: #82ffa1; 
			background: #0a1a0a;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(130, 255, 161, 0.1);
		}
		.card-arrow { 
			position: absolute; 
			top: 18px; 
			right: 18px; 
			color: #82ffa1; 
			font-size: 18px; 
			opacity: 0.7;
			transition: opacity 0.2s ease;
		}
		.clickable-card:hover .card-arrow { 
			opacity: 1; 
			transform: translateX(2px);
		}

		.sectionTitle { font-size:20px; margin: 0 0 12px 0; }
		.row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
		.kpi { text-align:center; padding:14px; border:1px solid #222; border-radius:12px; background:#0f0f0f; }
		.kpi .num { font-size:20px; font-weight:700; }
		.kpi .lbl { color:#bdbdbd; font-size:12px; }

		.footer { text-align:center; color:#8a8a8a; font-size:12px; padding: 24px 0 40px; }

		/* Modal */
		.modalBack { position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; place-items:center; z-index:1000; }
		.modal { width:min(860px,94vw); max-height:80vh; overflow:auto; background:#0f0f0f; border:1px solid #2a2a2a; border-radius:16px; padding:20px; }
		.modal h2 { margin:0 0 10px 0; font-size:20px; }
		.modal .qgrid { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); margin-top: 8px; }
		.qcard { border:1px solid #222; border-radius:12px; padding:12px; background:#111; }
		.qtop { display:flex; align-items:center; justify-content:space-between; gap:8px; }
		.qdiff { font-size:12px; padding:4px 8px; border:1px solid #333; border-radius:999px; color:#e5e5e5; }
		.qdesc { color:#cfcfcf; font-size:14px; margin:10px 0; line-height:1.5; }
		.qrow { display:flex; align-items:center; justify-content:space-between; }
		.qreward { color:#82ffa1; font-weight:700; }
		.linkish { color:#fff; text-decoration:none; }

		/* Profile chips */
		.chips { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
		.chip { font-size:12px; padding:4px 8px; border:1px solid #333; border-radius:999px; color:#e5e5e5; }

		/* Wallet styles */
		.wallet-section { margin-top: 16px; }
		.wallet-info { display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:center; }
		.wallet-address { font-family:monospace; font-size:12px; color:#82ffa1; background:#0f0f0f; padding:6px 12px; border-radius:8px; border:1px solid #2a2a2a; }

		/* Quest progress */
		.quest-progress { background:#1a4a2e; border:1px solid #2a5a3e; border-radius:8px; padding:8px; margin-top:8px; }
		.progress-bar { background:#0f0f0f; height:6px; border-radius:3px; overflow:hidden; }
		.progress-fill { background:#82ffa1; height:100%; transition:width 0.3s ease; }

		/* Dashboard styles */
		.dashboard-grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); margin-top:16px; }
		.chart-container { background:#0f0f0f; border:1px solid #222; border-radius:12px; padding:16px; min-height:200px; }
		.stat-item { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid #2a2a2a; }
		.stat-item:last-child { border-bottom:none; }
		.stat-value { color:#82ffa1; font-weight:700; }

		/* Completed quest styling */
		.qcard.completed { background:#0f1f0f; border-color:#2a5a2a; }
		.qcard.completed .qtop h3 { color:#82ffa1; }

		/* Profile creation styles */
		.avatar-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; margin:12px 0; }
		.avatar-option { 
			font-size:32px; 
			padding:12px; 
			text-align:center; 
			border:2px solid #333; 
			border-radius:12px; 
			cursor:pointer; 
			transition:all 0.2s ease;
			background:#1a1a1a;
		}
		.avatar-option:hover { border-color:#82ffa1; background:#0a1a0a; }
		.avatar-option.selected { border-color:#82ffa1; background:#1a4a2e; }
		
		.skills-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:8px; margin:12px 0; }
		.skill-checkbox { 
			display:flex; 
			align-items:center; 
			gap:8px; 
			padding:8px 12px; 
			border:1px solid #333; 
			border-radius:8px; 
			cursor:pointer;
			transition:all 0.2s ease;
			background:#1a1a1a;
		}
		.skill-checkbox:hover { border-color:#82ffa1; background:#0a1a0a; }
		.skill-checkbox input[type="checkbox"] { 
			accent-color:#82ffa1; 
			width:16px; 
			height:16px; 
		}
		.skill-checkbox input[type="checkbox"]:checked + * { color:#82ffa1; }

		/* User profile display */
		.user-profile-display { 
			display:flex; 
			align-items:center; 
			gap:12px; 
			background:#0f1f0f; 
			border:1px solid #2a5a2a; 
			border-radius:12px; 
			padding:12px; 
			margin-top:12px;
		}
		.user-avatar { font-size:24px; }
		.user-info h4 { margin:0; color:#82ffa1; }
		.user-info p { margin:0; font-size:12px; color:#cfcfcf; }

		/* Loading spinner */
		.spinner {
			width: 20px;
			height: 20px;
			border: 2px solid #333;
			border-top: 2px solid #82ffa1;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			display: inline-block;
			margin-right: 8px;
		}
		
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		/* Loading button state */
		.btn.loading {
			opacity: 0.7;
			cursor: not-allowed;
			position: relative;
		}

		.btn.loading::before {
			content: '';
			width: 16px;
			height: 16px;
			border: 2px solid transparent;
			border-top: 2px solid currentColor;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			position: absolute;
			left: 12px;
			top: 50%;
			transform: translateY(-50%);
		}

		/* Quest content styling */
		#questContentBody { line-height: 1.6; }
		#questContentBody h3 { color: #82ffa1; margin: 0 0 12px 0; }
		#questContentBody h4 { color: #fff; margin: 16px 0 8px 0; }
		#questContentBody p { margin: 0 0 12px 0; color: #cfcfcf; }
		#questContentBody ul { margin: 8px 0; padding-left: 20px; }
		#questContentBody li { margin: 4px 0; color: #cfcfcf; }
		#questContentBody code { 
			background: #1a1a1a; 
			padding: 2px 6px; 
			border-radius: 4px; 
			font-family: 'Courier New', monospace;
			color: #82ffa1;
			font-size: 13px;
		}
		#questContentBody pre { 
			background: #1a1a1a; 
			padding: 16px; 
			border-radius: 8px; 
			overflow-x: auto;
			margin: 12px 0;
			border-left: 3px solid #82ffa1;
		}
		#questContentBody pre code { 
			background: none; 
			padding: 0; 
			color: #e5e5e5;
			font-size: 14px;
		}

		/* Responsive grid layouts */
		@media (min-width: 900px) {
			.grid { grid-template-columns: repeat(3, 1fr); justify-items: stretch; }
		}

		@media (max-width: 768px) {
			.container { width: 95vw; padding: 12px; }
			.header { padding: 15px 0 12px; }
			.logo-section { gap: 0px; }
			.main-logo { width: 110px; margin-bottom: -10px; }
			h1 { font-size: clamp(24px, 6vw, 32px); }
			.subtitle { font-size: 14px; }
			
			/* Mobile-friendly buttons */
			.ctaRow { flex-direction: column; align-items: stretch; }
			.btn { padding: 14px 20px; font-size: 16px; }
			
			/* Mobile wallet section */
			.wallet-section { margin-top: 12px; }
			.wallet-info { flex-direction: column; gap: 8px; text-align: center; }
			.wallet-address { font-size: 11px; }
			
			/* Mobile grid */
			.grid { grid-template-columns: 1fr; gap: 12px; }
			.card { padding: 14px; }
			.card h3 { font-size: 16px; }
			.card p { font-size: 14px; line-height: 1.4; }
			
			/* Mobile dashboard */
			.dashboard-grid { grid-template-columns: 1fr; }
			.chart-container { min-height: 150px; padding: 12px; }
			
			/* Mobile KPIs */
			.kpi { padding: 10px; }
			.kpi .num { font-size: 18px; }
			.kpi .lbl { font-size: 11px; }
			
			/* Mobile modals */
			.modal { width: 95vw; max-height: 85vh; padding: 16px; }
			.modal h2 { font-size: 18px; }
			.qgrid { grid-template-columns: 1fr; }
			.qcard { padding: 10px; }
			
			/* Mobile quest content */
			#questContentBody { font-size: 14px; }
			#questContentBody h3 { font-size: 16px; }
			#questContentBody pre { padding: 12px; font-size: 12px; overflow-x: auto; }
			#questContentBody code { font-size: 11px; }
			
			/* Mobile chips */
			.chips { justify-content: center; }
			.chip { font-size: 11px; padding: 3px 6px; }
			
			/* Mobile notifications */
			.notification { 
				position: fixed !important;
				top: 10px !important;
				left: 10px !important;
				right: 10px !important;
				width: auto !important;
				font-size: 14px !important;
			}
		}

		@media (max-width: 480px) {
			.container { width: 98vw; padding: 8px; }
			h1 { font-size: 20px; }
			.subtitle { font-size: 13px; }
			
			/* Extra small mobile adjustments */
			.btn { padding: 12px 16px; font-size: 14px; }
			.card { padding: 12px; }
			.modal { padding: 12px; }
			.qcard { padding: 8px; }
			
			/* Mobile-first navigation */
			.qtop { flex-direction: column; align-items: flex-start; gap: 4px; }
			.qdiff { font-size: 10px; }
			
			/* Compact mobile layout */
			.stat-item { padding: 6px 0; font-size: 13px; }
			.kpi { padding: 8px; }
			.kpi .num { font-size: 16px; }
		}
	</style>
</head>
<body>
	<!-- Logo Section (Moved to top) -->
	<div class="container" style="text-align: center; padding: 20px 20px 10px;">
		<img src="logo.png" alt="Move Builders Hub" class="main-logo">
	</div>

	<header class="container header">
		<h1>Move Builders Hub ‚Ä¢ On-Chain Move Learning</h1>
		<p class="subtitle">A collaboration-first platform that tracks Move learning on-chain with quests, mentorship, collaboration sessions, sponsor rewards, and analytics.</p>
		<div class="badges">
			<span class="badge">Aptos Testnet</span>
			<span class="badge">Move Language</span>
			<span class="badge">On-Chain Proof</span>
			<span class="badge">Mentorship</span>
			<span class="badge">Collaboration</span>
			<span class="badge">Sponsors & Rewards</span>
		</div>
		<div class="ctaRow">
			<button class="btn" id="exploreQuests">Explore Quests</button>
			<button class="btn secondary" id="viewStats">View Analytics</button>
		</div>
		<div class="wallet-section">
			<button class="btn" id="connectWallet" style="display:none;">Connect Petra Wallet</button>
			<div id="walletInfo" style="display:none;" class="wallet-info">
				<span class="badge">üü¢ Connected</span>
				<span id="walletAddress" class="wallet-address"></span>
				<button class="btn secondary" id="disconnectWallet">Disconnect</button>
			</div>
			<!-- Simple referral link (only shows when connected) -->
			<div id="referralSection" style="display:none; margin-top:12px;">
				<button class="btn secondary" id="getReferralLink" style="font-size:12px;">üîó Get Referral Link</button>
			</div>
		</div>
	</header>

	<main class="container">
		<section>
			<h2 class="sectionTitle">Highlights</h2>
			<div class="grid">
				<div class="card clickable-card" onclick="scrollToQuests()">
					<h3>üéØ Quest System</h3>
					<p>Practice with leveled Move quests and record progress on-chain.</p>
					<div class="card-arrow">‚Üí</div>
				</div>
				<div class="card clickable-card" onclick="scrollToMentorship()">
					<h3>üë• Mentorship</h3>
					<p>Match with experienced Move devs, schedule 1:1 sessions, grow faster.</p>
					<div class="card-arrow">‚Üí</div>
				</div>
				<div class="card clickable-card" onclick="scrollToCollaboration()">
					<h3>ü§ù Collaboration</h3>
					<p>Pair-program and join mini-hackathons to solve real problems together.</p>
					<div class="card-arrow">‚Üí</div>
				</div>
				<div class="card clickable-card" onclick="scrollToRewards()">
					<h3>üèÜ Rewards & Sponsors</h3>
					<p>Complete sponsor quests and earn rewards. Sustainable, tokenless model.</p>
					<div class="card-arrow">‚Üí</div>
				</div>
				<div class="card clickable-card" onclick="scrollToAnalytics()">
					<h3>üìä Analytics</h3>
					<p>DAU, quest completion rate, and average difficulty over time.</p>
					<div class="card-arrow">‚Üí</div>
				</div>
				<div class="card clickable-card" onclick="scrollToProfiles()">
					<h3>üîê Builder Profiles</h3>
					<p>Meet experienced Move developers and view their achievements.</p>
					<div class="card-arrow">‚Üí</div>
				</div>
			</div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Builder Profiles</h2>
			<div class="grid" id="profilesGrid"></div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Live Analytics Dashboard</h2>
			<div class="grid">
				<div class="kpi"><div class="num" id="activeDevelopers">100+</div><div class="lbl">Active Developers</div></div>
				<div class="kpi"><div class="num" id="completedQuests">50+</div><div class="lbl">Completed Quests</div></div>
				<div class="kpi"><div class="num" id="onChainTx">24/7</div><div class="lbl">On-Chain Transactions</div></div>
			</div>
			
			<div class="dashboard-grid">
				<div class="chart-container">
					<h3 style="margin:0 0 12px 0;">Quest Completion Trend</h3>
					<canvas id="questChart" width="300" height="150"></canvas>
				</div>
				<div class="chart-container">
					<h3 style="margin:0 0 12px 0;">Developer Activity</h3>
					<div id="activityStats">
						<div class="stat-item">
							<span>Daily Active Users</span>
							<span class="stat-value" id="dailyActiveUsers">45</span>
						</div>
						<div class="stat-item">
							<span>Weekly New Developers</span>
							<span class="stat-value" id="weeklyNewDevs">12</span>
						</div>
						<div class="stat-item">
							<span>Average Session Time</span>
							<span class="stat-value" id="avgSessionTime">24min</span>
						</div>
						<div class="stat-item">
							<span>Quest Success Rate</span>
							<span class="stat-value" id="questSuccessRate">78%</span>
						</div>
					</div>
				</div>
			</div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Mentorship & Collaboration</h2>
			<div class="grid">
				<div class="card">
					<h3>Schedule Mentorship</h3>
					<p>Create your profile and goals, match with mentors via calendar.</p>
					<button class="btn" id="findMentorBtn">Find Mentor</button>
				</div>
				<div class="card">
					<h3>Pair Programming</h3>
					<p>Team up on specific quests, exchange knowledge and code together.</p>
					<button class="btn secondary" id="joinPairBtn">Join Session</button>
				</div>
				<div class="card">
					<h3>Mini-Hackathons</h3>
					<p>Sponsor-supported, time-boxed events for focused building.</p>
					<button class="btn" id="viewHackathonsBtn">View Events</button>
				</div>
			</div>
			
			<!-- Active Collaborations -->
			<div style="margin-top:20px;">
				<h3>üî• Active Collaborations</h3>
				<div class="grid" id="collaborationsGrid">
					<div class="card">
						<h4>DeFi Protocol Build</h4>
						<p>Building a lending protocol in Move. <strong>3/5 spots filled</strong></p>
						<div class="chips">
							<span class="chip">Advanced</span>
							<span class="chip">2 weeks</span>
							<span class="chip">Reward: 5 APT</span>
						</div>
						<button class="btn" onclick="joinCollaboration('defi-protocol')">Join Team</button>
					</div>
					<div class="card">
						<h4>NFT Marketplace</h4>
						<p>Creating an NFT trading platform. <strong>2/4 spots filled</strong></p>
						<div class="chips">
							<span class="chip">Intermediate</span>
							<span class="chip">3 weeks</span>
							<span class="chip">Reward: 3 APT</span>
						</div>
						<button class="btn" onclick="joinCollaboration('nft-marketplace')">Join Team</button>
					</div>
					<div class="card">
						<h4>Move Learning Game</h4>
						<p>Gamified Move education platform. <strong>1/3 spots filled</strong></p>
						<div class="chips">
							<span class="chip">Beginner</span>
							<span class="chip">1 week</span>
							<span class="chip">Reward: 1 APT</span>
						</div>
						<button class="btn" onclick="joinCollaboration('learning-game')">Join Team</button>
					</div>
				</div>
			</div>
		</section>

		<div class="divider"></div>

		<section>
			<h2 class="sectionTitle">Rewards & Sponsors</h2>
			<div class="grid">
				<div class="card">
					<h3>Sponsor Pools</h3>
					<p>Sponsors open themed pools; complete quests and earn points.</p>
					<button class="btn" id="viewSponsorPools">View Active Pools</button>
				</div>
				<div class="card">
					<h3>Fair Evaluation</h3>
					<p>Collaboration over competition. No exploit-chasing mechanics.</p>
					<button class="btn secondary" id="leaderboardBtn">View Leaderboard</button>
				</div>
				<div class="card">
					<h3>Transparency</h3>
					<p>On-chain records make progress and rewards verifiable.</p>
					<button class="btn secondary" id="verifyRewards">Verify My Rewards</button>
				</div>
			</div>
			
			<!-- Active Sponsor Pools -->
			<div style="margin-top:20px;">
				<h3>üí∞ Active Sponsor Pools</h3>
				<div class="grid">
					<div class="card">
						<h4>üè¶ Aptos Foundation Pool</h4>
						<p>Focus on core Move development and education</p>
						<div class="chips">
							<span class="chip">Pool: 1000 APT</span>
							<span class="chip">Participants: 127</span>
							<span class="chip">Ends: Feb 28</span>
						</div>
						<div style="margin-top:12px;">
							<div class="progress-bar">
								<div class="progress-fill" style="width:65%"></div>
							</div>
							<small>65% distributed</small>
						</div>
						<button class="btn" onclick="joinSponsorPool('aptos-foundation')">Join Pool</button>
					</div>
					<div class="card">
						<h4>üîä Decibel Pool</h4>
						<p>Infrastructure and developer tooling focus</p>
						<div class="chips">
							<span class="chip">Pool: 750 APT</span>
							<span class="chip">Participants: 92</span>
							<span class="chip">Ends: Feb 15</span>
						</div>
						<div style="margin-top:12px;">
							<div class="progress-bar">
								<div class="progress-fill" style="width:45%"></div>
							</div>
							<small>45% distributed</small>
						</div>
						<button class="btn" onclick="joinSponsorPool('decibel')">Join Pool</button>
					</div>
					<div class="card">
						<h4>‚ö° Shelby Protocol Pool</h4>
						<p>Cross-chain and interoperability solutions</p>
						<div class="chips">
							<span class="chip">Pool: 400 APT</span>
							<span class="chip">Participants: 67</span>
							<span class="chip">Ends: Mar 10</span>
						</div>
						<div style="margin-top:12px;">
							<div class="progress-bar">
								<div class="progress-fill" style="width:30%"></div>
							</div>
							<small>30% distributed</small>
						</div>
						<button class="btn" onclick="joinSponsorPool('shelby-protocol')">Join Pool</button>
					</div>
				</div>
			</div>
		</section>
	</main>

	<footer class="footer container">
		Move Builders Hub ‚Ä¢ Aptos Testnet ‚Ä¢ ¬© 2025
	</footer>

	<!-- Quests Modal -->
	<div id="questsModal" class="modalBack">
		<div class="modal">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üöÄ Available Move Quests</h2>
				<a class="linkish" href="#" id="closeModal">Close ‚úï</a>
			</div>
			<p class="subtitle">Interactive Move learning quests with on-chain completion tracking.</p>
			<div class="qgrid" id="qgrid"></div>
		</div>
	</div>

	<!-- Quest Content Modal -->
	<div id="questContentModal" class="modalBack">
		<div class="modal" style="max-width:900px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2 id="questContentTitle">Quest Content</h2>
				<a class="linkish" href="#" id="closeQuestContent">Close ‚úï</a>
			</div>
			<div id="questContentBody"></div>
			<div style="margin-top:20px; display:flex; gap:12px; justify-content:space-between;">
				<button class="btn secondary" id="prevStep">‚Üê Previous</button>
				<div style="flex:1; text-align:center;">
					<span id="stepIndicator">Step 1 of 3</span>
				</div>
				<button class="btn" id="nextStep">Next ‚Üí</button>
			</div>
		</div>
	</div>

	<!-- Profile Modal -->
	<div id="profileModal" class="modalBack">
		<div class="modal">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2 id="pm_name">Builder Profile</h2>
				<a class="linkish" href="#" id="pm_close">Close ‚úï</a>
			</div>
			<p id="pm_bio" class="subtitle"></p>
			<div class="chips" id="pm_skills"></div>
			<div class="row" style="margin-top:10px">
				<span id="pm_avail" class="badge"></span>
				<span id="pm_tz" class="badge"></span>
			</div>
			<div style="margin-top:12px" id="pm_links" class="row"></div>
			<div class="divider"></div>
			<div class="row" style="gap:16px">
				<div class="kpi"><div class="num" id="pm_completed">0</div><div class="lbl">Completed</div></div>
				<div class="kpi"><div class="num" id="pm_streak">0</div><div class="lbl">Streak (days)</div></div>
			</div>
			<div style="margin-top:12px">
				<h3 style="margin:0 0 8px 0; font-size:16px">Badges</h3>
				<div class="chips" id="pm_badges"></div>
			</div>
		</div>
	</div>

	<!-- Create Profile Modal -->
	<div id="createProfileModal" class="modalBack">
		<div class="modal" style="max-width:600px;">
			<div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
				<h2>üöÄ Create Your Builder Profile</h2>
				<a class="linkish" href="#" id="closeCreateProfile">Close ‚úï</a>
			</div>
			<p class="subtitle">Set up your profile to start earning rewards and connect with mentors!</p>
			
			<div style="margin:20px 0;">
				<!-- Avatar Selection -->
				<h3 style="margin:0 0 12px 0;">Choose Avatar</h3>
				<div class="avatar-grid" id="avatarGrid">
					<div class="avatar-option" data-avatar="üßë‚Äçüíª" onclick="selectAvatar('üßë‚Äçüíª')">üßë‚Äçüíª</div>
					<div class="avatar-option" data-avatar="üë®‚Äçüíª" onclick="selectAvatar('üë®‚Äçüíª')">üë®‚Äçüíª</div>
					<div class="avatar-option" data-avatar="üë©‚Äçüíª" onclick="selectAvatar('üë©‚Äçüíª')">üë©‚Äçüíª</div>
					<div class="avatar-option" data-avatar="ü¶Ñ" onclick="selectAvatar('ü¶Ñ')">ü¶Ñ</div>
					<div class="avatar-option" data-avatar="üöÄ" onclick="selectAvatar('üöÄ')">üöÄ</div>
					<div class="avatar-option" data-avatar="‚ö°" onclick="selectAvatar('‚ö°')">‚ö°</div>
					<div class="avatar-option" data-avatar="üî•" onclick="selectAvatar('üî•')">üî•</div>
					<div class="avatar-option" data-avatar="üíé" onclick="selectAvatar('üíé')">üíé</div>
				</div>
				
				<!-- Username -->
				<h3 style="margin:20px 0 8px 0;">Username</h3>
				<input type="text" id="usernameInput" placeholder="Enter your username..." style="width:100%; padding:12px; background:#1a1a1a; border:1px solid #333; border-radius:8px; color:#fff; font-size:14px;">
				
				<!-- Bio -->
				<h3 style="margin:20px 0 8px 0;">Bio</h3>
				<textarea id="bioInput" placeholder="Tell us about yourself and your Move experience..." style="width:100%; height:80px; padding:12px; background:#1a1a1a; border:1px solid #333; border-radius:8px; color:#fff; font-size:14px; resize:vertical;"></textarea>
				
				<!-- Email -->
				<h3 style="margin:20px 0 8px 0;">Email Address <span style="color:#ff6b6b;">*</span></h3>
				<input type="email" id="emailInput" placeholder="your@email.com" required style="width:100%; padding:12px; background:#1a1a1a; border:1px solid #333; border-radius:8px; color:#fff; font-size:14px;">
				<small style="color:#888; font-size:12px;">üîí Required for hackathon invites, mentorship bookings, and notifications</small>
				
				<!-- Skills -->
				<h3 style="margin:20px 0 8px 0;">Skills & Interests</h3>
				<div class="skills-grid">
					<label class="skill-checkbox"><input type="checkbox" value="Move"> Move Language</label>
					<label class="skill-checkbox"><input type="checkbox" value="Aptos"> Aptos Ecosystem</label>
					<label class="skill-checkbox"><input type="checkbox" value="DeFi"> DeFi Development</label>
					<label class="skill-checkbox"><input type="checkbox" value="NFT"> NFT Projects</label>
					<label class="skill-checkbox"><input type="checkbox" value="Security"> Security Auditing</label>
					<label class="skill-checkbox"><input type="checkbox" value="Frontend"> Frontend Development</label>
					<label class="skill-checkbox"><input type="checkbox" value="Backend"> Backend Development</label>
					<label class="skill-checkbox"><input type="checkbox" value="Education"> Teaching & Education</label>
				</div>
				
				<!-- Experience Level -->
				<h3 style="margin:20px 0 8px 0;">Experience Level</h3>
				<select id="experienceSelect" style="width:100%; padding:12px; background:#1a1a1a; border:1px solid #333; border-radius:8px; color:#fff;">
					<option value="beginner">Beginner - New to Move</option>
					<option value="intermediate">Intermediate - Some Move experience</option>
					<option value="advanced">Advanced - Experienced Move developer</option>
					<option value="expert">Expert - Move specialist/mentor</option>
				</select>
			</div>
			
			<div style="display:flex; gap:12px; justify-content:flex-end; margin-top:20px;">
				<button class="btn secondary" onclick="closeCreateProfile()">Cancel</button>
				<button class="btn" onclick="saveProfile()">Create Profile</button>
			</div>
		</div>
	</div>

	<script>
	(function(){
		// Wallet state
		let walletConnected = false;
		let walletAddress = null;
		let aptosClient = null;
		let userProfile = null;
		let selectedAvatar = 'üßë‚Äçüíª';

		// Initialize Aptos client
		const APTOS_NODE_URL = 'https://fullnode.testnet.aptoslabs.com/v1';
		
		// Mobile wallet detection
		function isMobile() {
			return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
		}

		function isIOS() {
			return /iPad|iPhone|iPod/.test(navigator.userAgent);
		}

		function isAndroid() {
			return /Android/.test(navigator.userAgent);
		}

		// Enhanced wallet connection with loading states
		async function connectWallet() {
			const connectBtn = document.getElementById('connectWallet');
			const originalText = connectBtn.textContent;
			
			// Show loading state
			connectBtn.classList.add('loading');
			connectBtn.textContent = 'Connecting...';
			connectBtn.disabled = true;

			try {
				// Mobile wallet handling
				if (isMobile()) {
					if (window.aptos) {
						// Petra mobile app is available
						const response = await window.aptos.connect();
						walletAddress = response.address;
						walletConnected = true;
						updateWalletUI();
						await loadUserProgress();
						
						showNotification(`
							<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
								<div>
									<h4 style="margin:0 0 8px 0;">‚úÖ Wallet Connected!</h4>
									<p style="margin:0;">Successfully connected to Petra mobile wallet.</p>
								</div>
							</div>
						`);
						return;
					} else {
						// Redirect to mobile wallet
						return handleMobileWalletConnection();
					}
				}

				// Desktop wallet handling
				if (!window.aptos) {
					showMobileWalletOptions();
					return;
				}

				const response = await window.aptos.connect();
				walletAddress = response.address;
				walletConnected = true;
				
				updateWalletUI();
				await loadUserProgress();
				
				// Track wallet connection
				trackEvent('wallet_connected', {
					walletType: isMobile() ? 'mobile' : 'desktop',
					address: walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4)
				});
				
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚úÖ Wallet Connected!</h4>
							<p style="margin:0;">Ready to start earning rewards and completing quests!</p>
						</div>
					</div>
				`);
				
			} catch (error) {
				console.error('Wallet connection failed:', error);
				
				// Show retry option
				showNotification(`
					<div style="text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ùå Connection Failed</h4>
							<p style="margin:0 0 12px 0;">Unable to connect to wallet. Please try again.</p>
							<button class="btn" onclick="connectWallet()">Retry Connection</button>
						</div>
					</div>
				`);
			} finally {
				// Reset button state
				connectBtn.classList.remove('loading');
				connectBtn.textContent = originalText;
				connectBtn.disabled = false;
			}
		}

		function handleMobileWalletConnection() {
			if (isIOS()) {
				// iOS - Try Petra app, fallback to App Store
				const petraDeepLink = 'https://petra.app/explore';
				const appStoreLink = 'https://apps.apple.com/app/petra-aptos-wallet/id6448061390';
				
				showNotification(`
					<div style="max-width:300px; text-align:center;">
						<h4>üì± Connect Mobile Wallet</h4>
						<p>Choose your preferred wallet:</p>
						<button class="btn" onclick="window.open('${petraDeepLink}', '_blank')" style="margin:4px; width:100%;">
							Open Petra Wallet
						</button>
						<button class="btn secondary" onclick="window.open('${appStoreLink}', '_blank')" style="margin:4px; width:100%;">
							Install Petra (iOS)
						</button>
						<p><small>After connecting in wallet app, return here</small></p>
					</div>
				`);
			} else if (isAndroid()) {
				// Android - Try Petra app, fallback to Play Store
				const petraDeepLink = 'https://petra.app/explore';
				const playStoreLink = 'https://play.google.com/store/apps/details?id=com.aptoslabs.petra.wallet';
				
				showNotification(`
					<div style="max-width:300px; text-align:center;">
						<h4>üì± Connect Mobile Wallet</h4>
						<p>Choose your preferred wallet:</p>
						<button class="btn" onclick="window.open('${petraDeepLink}', '_blank')" style="margin:4px; width:100%;">
							Open Petra Wallet
						</button>
						<button class="btn secondary" onclick="window.open('${playStoreLink}', '_blank')" style="margin:4px; width:100%;">
							Install Petra (Android)
						</button>
						<p><small>After connecting in wallet app, return here</small></p>
					</div>
				`);
			}
		}

		function showMobileWalletOptions() {
			const message = isMobile() ? 
				'üì± Please install a supported Aptos wallet app:' : 
				'üîó Please install Petra wallet extension or use mobile:';
				
			showNotification(`
				<div style="max-width:320px; text-align:center;">
					<h4>Wallet Required</h4>
					<p>${message}</p>
					${isMobile() ? `
						<button class="btn" onclick="window.open('https://petra.app/', '_blank')" style="margin:4px; width:100%;">
							üì± Get Petra Mobile
						</button>
					` : `
						<button class="btn" onclick="window.open('https://petra.app/', '_blank')" style="margin:4px; width:100%;">
							üíª Get Petra Extension
						</button>
						<button class="btn secondary" onclick="window.open(window.location.href, '_blank')" style="margin:4px; width:100%;">
							üì± Open on Mobile
						</button>
					`}
				</div>
			`);
		}

		async function disconnectWallet() {
			try {
				if (window.aptos) {
					await window.aptos.disconnect();
				}
				walletConnected = false;
				walletAddress = null;
				updateWalletUI();
				showNotification('Wallet disconnected');
			} catch (error) {
				console.error('Disconnect failed:', error);
			}
		}

		function updateWalletUI() {
			const connectBtn = document.getElementById('connectWallet');
			const walletInfo = document.getElementById('walletInfo');
			const addressSpan = document.getElementById('walletAddress');
			const referralSection = document.getElementById('referralSection');

			if (walletConnected && walletAddress) {
				connectBtn.style.display = 'none';
				walletInfo.style.display = 'flex';
				referralSection.style.display = 'block'; // Show referral link
				
				// Show user profile if exists, otherwise show address
				if (userProfile) {
					addressSpan.innerHTML = `
						<div class="user-profile-display">
							<span class="user-avatar">${userProfile.avatar}</span>
							<div class="user-info">
								<h4>${userProfile.username}</h4>
								<p>${userProfile.bio.substring(0, 30)}...</p>
							</div>
						</div>
					`;
				} else {
					addressSpan.textContent = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
				}
				
				// Check if user needs to create profile
				if (!userProfile) {
					setTimeout(() => {
						showCreateProfilePrompt();
					}, 1000);
				}
			} else {
				connectBtn.style.display = 'block';
				walletInfo.style.display = 'none';
				referralSection.style.display = 'none'; // Hide referral link
			}
		}

		// Simple referral system
		document.getElementById('getReferralLink').addEventListener('click', () => {
			const referralCode = walletAddress.slice(-8); // Use last 8 chars as referral code
			const referralLink = `https://movebuildershub.xyz?ref=${referralCode}`;
			
			navigator.clipboard.writeText(referralLink).then(() => {
				showNotification(`
					<div style="text-align:center; min-height:100px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">üîó Referral Link Copied!</h4>
							<p style="margin:0 0 8px 0;"><code style="font-size:12px;">${referralLink}</code></p>
							<p style="margin:0 0 12px 0;"><small>Friends who join via your link get +10% rewards!</small></p>
							<div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
								<button class="btn secondary" onclick="window.open('https://twitter.com/intent/tweet?text=üöÄ Learning Move programming on-chain at Move Builders Hub! Join me: ${encodeURIComponent(referralLink)}', '_blank')" style="font-size:12px;">Share on X</button>
								<button class="btn secondary" onclick="window.open('https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=üöÄ Learning Move programming on-chain!', '_blank')" style="font-size:12px;">Share on Telegram</button>
							</div>
						</div>
					</div>
				`);
			});
		});

		// Check for referral on page load
		function checkReferral() {
			const urlParams = new URLSearchParams(window.location.search);
			const referralCode = urlParams.get('ref');
			
			if (referralCode && !localStorage.getItem('referral_used')) {
				localStorage.setItem('referral_code', referralCode);
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">üéÅ Referral Bonus!</h4>
							<p style="margin:0;">You'll get +10% rewards when you complete your first quest!</p>
						</div>
					</div>
				`);
			}
		}

		function showCreateProfilePrompt() {
			showNotification(`
				<div style="text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;">
					<div>
						<h4 style="margin:0 0 8px 0;">üöÄ Welcome to Move Builders Hub!</h4>
						<p style="margin:0 0 12px 0;">Create your profile to unlock all features</p>
						<button class="btn" onclick="openCreateProfile()">Create Profile</button>
					</div>
				</div>
			`);
		}

		// Rate limiting state
		const rateLimits = {
			questCompletion: { count: 0, resetTime: 0, limit: 3 }, // 3 per minute
			profileUpdate: { count: 0, resetTime: 0, limit: 1 }   // 1 per minute
		};

		function checkRateLimit(action) {
			const limit = rateLimits[action];
			const now = Date.now();
			
			// Reset counter if minute passed
			if (now > limit.resetTime) {
				limit.count = 0;
				limit.resetTime = now + 60000; // 1 minute
			}
			
			if (limit.count >= limit.limit) {
				const remainingTime = Math.ceil((limit.resetTime - now) / 1000);
				return { allowed: false, remainingTime };
			}
			
			limit.count++;
			return { allowed: true };
		}

		// Enhanced quest completion with loading and rate limiting
		async function completeQuest(questId) {
			if (!walletConnected) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">üîó Wallet Required</h4>
							<p style="margin:0;">Please connect your wallet to complete quests!</p>
						</div>
					</div>
				`);
				return;
			}

			// Rate limiting check
			const rateCheck = checkRateLimit('questCompletion');
			if (!rateCheck.allowed) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚è±Ô∏è Please Wait</h4>
							<p style="margin:0;">Too many requests. Try again in ${rateCheck.remainingTime} seconds.</p>
						</div>
					</div>
				`);
				return;
			}

			try {
				// Show loading notification
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<div class="spinner"></div>
							<h4 style="margin:0 0 8px 0;">üîÑ Processing Quest</h4>
							<p style="margin:0;">Submitting completion to Aptos blockchain...</p>
						</div>
					</div>
				`);
				
				// Simulate on-chain transaction with realistic delay
				const txHash = await submitQuestCompletion(questId);
				
				// Update quest status
				const quest = quests.find(q => q.id === questId);
				if (quest) {
					quest.completed = true;
					quest.progress = 100;
					quest.onChainTx = txHash;
					
					// Update user profile and award badges
					if (userProfile) {
						userProfile.questsCompleted++;
						userProfile.streak++;
						
						// Award milestone badges (simple achievement system)
						const newBadges = [];
						if (userProfile.questsCompleted === 1) newBadges.push('First Quest');
						if (userProfile.questsCompleted === 3) newBadges.push('Getting Started');
						if (userProfile.questsCompleted === 6) newBadges.push('Quest Master');
						if (userProfile.streak === 3) newBadges.push('On Fire');
						if (userProfile.streak === 7) newBadges.push('Streak Legend');
						
						newBadges.forEach(badge => {
							if (!userProfile.badges.includes(badge)) {
								userProfile.badges.push(badge);
							}
						});
						
						localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));
					}
					
					// Track quest completion
					trackEvent('quest_completed', {
						questId: questId,
						questTitle: quest.title,
						difficulty: quest.diff,
						txHash: txHash
					});
				}

				showNotification(`
					<div style="text-align:center; min-height:100px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">üéâ Quest Completed!</h4>
							<p style="margin:0 0 8px 0;">Successfully recorded on Aptos blockchain.</p>
							<p style="margin:0 0 12px 0;"><small>Transaction: ${txHash.slice(0,8)}...${txHash.slice(-6)}</small></p>
							<div style="display:flex; gap:8px; justify-content:center;">
								<button class="btn secondary" onclick="shareAchievement('${quest.title}', '${txHash}')" style="font-size:12px;">Share Achievement</button>
								<button class="btn" onclick="viewNextQuest(${questId})" style="font-size:12px;">Next Quest</button>
							</div>
						</div>
					</div>
				`);
				
				updateDashboard();
			} catch (error) {
				console.error('Quest completion failed:', error);
				
				// Show retry option
				showNotification(`
					<div style="text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ùå Transaction Failed</h4>
							<p style="margin:0 0 12px 0;">Blockchain transaction failed. Please try again.</p>
							<button class="btn" onclick="completeQuest(${questId})">Retry Quest</button>
						</div>
					</div>
				`);
			}
		}

		async function submitQuestCompletion(questId) {
			// Simulate API call to backend
			const response = await fetch('/api/complete-quest', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({
					walletAddress,
					questId,
					timestamp: Date.now()
				})
			});
			
			if (response.ok) {
				const data = await response.json();
				return data.txHash;
			}
			
			// Fallback: generate mock tx hash
			return '0x' + Math.random().toString(16).substr(2, 64);
		}

		async function loadUserProgress() {
			try {
				// Load user profile first
				await loadUserProfile();
				
				// Load user progress from backend
				const response = await fetch(`/api/user-progress/${walletAddress}`);
				if (response.ok) {
					const userData = await response.json();
					updateQuestsWithProgress(userData.quests);
				}
			} catch (error) {
				console.log('Could not load user progress, using defaults');
				// Still load local profile
				await loadUserProfile();
			}
		}

		function updateQuestsWithProgress(userQuests) {
			userQuests.forEach(userQuest => {
				const quest = quests.find(q => q.id === userQuest.id);
				if (quest) {
					quest.completed = userQuest.completed;
					quest.progress = userQuest.progress;
					quest.onChainTx = userQuest.onChainTx;
				}
			});
		}

		// Dashboard updates
		function updateDashboard() {
			const completedCount = quests.filter(q => q.completed).length;
			document.getElementById('completedQuests').textContent = completedCount;
			
			// Update other stats
			updateActivityStats();
			updateQuestChart();
		}

		function updateActivityStats() {
			// Simulate real-time data updates
			const stats = {
				dailyActiveUsers: Math.floor(Math.random() * 20) + 35,
				weeklyNewDevs: Math.floor(Math.random() * 10) + 8,
				avgSessionTime: Math.floor(Math.random() * 15) + 20 + 'min',
				questSuccessRate: Math.floor(Math.random() * 20) + 70 + '%'
			};

			Object.keys(stats).forEach(key => {
				const element = document.getElementById(key);
				if (element) element.textContent = stats[key];
			});
		}

		function updateQuestChart() {
			const canvas = document.getElementById('questChart');
			if (!canvas) return;
			
			const ctx = canvas.getContext('2d');
			const width = canvas.width;
			const height = canvas.height;
			
			// Clear canvas
			ctx.fillStyle = '#0f0f0f';
			ctx.fillRect(0, 0, width, height);
			
			// Draw simple chart
			const data = [12, 19, 15, 25, 32, 28, 35];
			const maxValue = Math.max(...data);
			const barWidth = width / data.length;
			
			ctx.fillStyle = '#82ffa1';
			data.forEach((value, index) => {
				const barHeight = (value / maxValue) * (height - 20);
				const x = index * barWidth + 10;
				const y = height - barHeight - 10;
				ctx.fillRect(x, y, barWidth - 5, barHeight);
			});
		}

		function showNotification(message) {
			// Create modal-style notification
			const overlay = document.createElement('div');
			const notification = document.createElement('div');
			const isMobileDevice = isMobile();
			
			// Overlay background
			overlay.style.cssText = `
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(0,0,0,0.7);
				z-index: 9999;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
			`;
			
			// Notification content
			notification.style.cssText = `
				background: #0f0f0f;
				color: #fff;
				padding: 24px;
				border-radius: 12px;
				border: 1px solid #2a2a2a;
				max-width: ${isMobileDevice ? '90vw' : '500px'};
				max-height: ${isMobileDevice ? '80vh' : '70vh'};
				overflow-y: auto;
				box-shadow: 0 8px 32px rgba(0,0,0,0.6);
				position: relative;
				font-size: ${isMobileDevice ? '16px' : '15px'};
				line-height: 1.5;
			`;
			notification.innerHTML = message;
			
			// Add close button with proper spacing
			const closeBtn = document.createElement('button');
			closeBtn.innerHTML = '√ó';
			closeBtn.style.cssText = `
				position: absolute;
				top: 8px;
				right: 8px;
				background: rgba(255,255,255,0.1);
				border: none;
				color: #fff;
				font-size: 20px;
				cursor: pointer;
				padding: 4px;
				width: 28px;
				height: 28px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 10;
			`;
			closeBtn.onmouseover = () => closeBtn.style.background = 'rgba(255,255,255,0.2)';
			closeBtn.onmouseout = () => closeBtn.style.background = 'rgba(255,255,255,0.1)';
			closeBtn.onclick = () => overlay.remove();
			
			// Add padding to notification content to avoid overlap with close button
			notification.style.paddingRight = '50px';
			notification.appendChild(closeBtn);
			
			// Close on overlay click
			overlay.onclick = (e) => {
				if (e.target === overlay) overlay.remove();
			};
			
			overlay.appendChild(notification);
			document.body.appendChild(overlay);
			
			// Auto-remove after longer time
			setTimeout(() => {
				if (overlay.parentNode) {
					overlay.remove();
				}
			}, isMobileDevice ? 8000 : 6000);
		}

		// Check wallet connection on load
		async function checkWalletConnection() {
			// Always show connect button on mobile
			if (isMobile()) {
				document.getElementById('connectWallet').style.display = 'block';
				document.getElementById('connectWallet').textContent = 'üì± Connect Mobile Wallet';
			}

			if (window.aptos) {
				try {
					const account = await window.aptos.account();
					if (account) {
						walletAddress = account.address;
						walletConnected = true;
						updateWalletUI();
						await loadUserProgress();
					}
				} catch (error) {
					// Wallet not connected
				}
				
				// Show connect button if wallet available
				document.getElementById('connectWallet').style.display = 'block';
				if (isMobile()) {
					document.getElementById('connectWallet').textContent = 'üì± Connect Petra Mobile';
				}
			}
		}

		// Mobile-specific wallet handling
		function handleMobileWalletReturn() {
			// Check if user returned from wallet app
			if (isMobile() && !walletConnected) {
				setTimeout(async () => {
					if (window.aptos) {
						try {
							const account = await window.aptos.account();
							if (account) {
								walletAddress = account.address;
								walletConnected = true;
								updateWalletUI();
								await loadUserProgress();
								showNotification('‚úÖ Mobile wallet connected!');
							}
						} catch (error) {
							console.log('Auto-connection attempt failed');
						}
					}
				}, 2000);
			}
		}

		// Handle page visibility changes (mobile app switching)
		document.addEventListener('visibilitychange', () => {
			if (!document.hidden && isMobile()) {
				handleMobileWalletReturn();
			}
		});
		// Interactive quest content data
		const questContents = {
			1: {
				title: 'üéØ Basic Move Syntax',
				steps: [
					{
						title: 'Challenge 1: Variable Declaration',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Create a Move function that declares variables of different types.</p>
							
							<h4>üìù Task:</h4>
							<p>Complete this function by filling in the missing variable declarations:</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>fun init_user_data(): (u64, address, bool) {
    let user_balance: u64 = <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 6px; border-radius:4px;">_____</span>;  // Set to 1000
    let user_addr: address = <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 6px; border-radius:4px;">_____</span>;  // Set to @0x1
    let is_active: bool = <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 6px; border-radius:4px;">_____</span>;     // Set to true
    
    (user_balance, user_addr, is_active)
}</code></pre>
							</div>

							<div style="background:#1a3a4a; padding:12px; border-radius:8px; margin:12px 0;">
								<h4>‚úèÔ∏è Your Task:</h4>
								<p><strong>Fill in the blanks:</strong></p>
								<ul>
									<li>Line 2: Replace <code style="background:#4a1a1a; color:#ff6b6b;">_____</code> with <code>1000</code></li>
									<li>Line 3: Replace <code style="background:#4a1a1a; color:#ff6b6b;">_____</code> with <code>@0x1</code></li>
									<li>Line 4: Replace <code style="background:#4a1a1a; color:#ff6b6b;">_____</code> with <code>true</code></li>
								</ul>
							</div>

							<h4>üí° Hint:</h4>
							<ul>
								<li><code>u64</code> - Use numbers like 1000</li>
								<li><code>address</code> - Use @0x1 format</li>
								<li><code>bool</code> - Use true or false</li>
							</ul>

							<div style="background:#1a4a2e; padding:12px; border-radius:8px; margin:12px 0;">
								<p><strong>üéì Learning Goal:</strong> Master Move's basic data types and variable declaration syntax.</p>
							</div>
						`
					},
					{
						title: 'Challenge 2: Function Implementation',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Implement a calculator function in Move.</p>
							
							<h4>üìù Task:</h4>
							<p>Complete the calculator module:</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>module 0x1::calculator {
    public fun add(a: u64, b: u64): u64 {
        // TODO: Return sum of a and b
        <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 6px; border-radius:4px;">_____</span>
    }
    
    public fun multiply(a: u64, b: u64): u64 {
        // TODO: Return product of a and b
        <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 6px; border-radius:4px;">_____</span>
    }
    
    public fun is_greater(a: u64, b: u64): bool {
        // TODO: Return true if a > b
        <span style="background:#4a1a1a; color:#ff6b6b; padding:2px 6px; border-radius:4px;">_____</span>
    }
}</code></pre>
							</div>

							<div style="background:#1a3a4a; padding:12px; border-radius:8px; margin:12px 0;">
								<h4>‚úèÔ∏è Complete the functions:</h4>
								<ul>
									<li><code>add</code>: Replace <code style="background:#4a1a1a; color:#ff6b6b;">_____</code> with <code>a + b</code></li>
									<li><code>multiply</code>: Replace <code style="background:#4a1a1a; color:#ff6b6b;">_____</code> with <code>a * b</code></li>
									<li><code>is_greater</code>: Replace <code style="background:#4a1a1a; color:#ff6b6b;">_____</code> with <code>a > b</code></li>
								</ul>
							</div>

							<h4>üîç Test Cases:</h4>
							<ul>
								<li><code>add(5, 3)</code> should return <code>8</code></li>
								<li><code>multiply(4, 7)</code> should return <code>28</code></li>
								<li><code>is_greater(10, 5)</code> should return <code>true</code></li>
							</ul>
						`
					},
					{
						title: 'Challenge 3: Code Review',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Review this Move code and identify what it does.</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>module 0x1::user_system {
    public fun process_user(
        name: vector&lt;u8&gt;, 
        age: u8, 
        balance: u64
    ): bool {
        let min_age: u8 = 18;
        let min_balance: u64 = 100;
        
        if (age >= min_age && balance >= min_balance) {
            return true
        };
        false
    }
}</code></pre>
							</div>

							<h4>‚ùì Quiz:</h4>
							<div style="background:#1a3a4a; padding:12px; border-radius:8px; margin:8px 0;">
								<p><strong>What does this function do?</strong></p>
								<p>A) Creates a new user account<br/>
								B) Checks if user meets minimum requirements<br/>
								C) Transfers money between users<br/>
								D) Deletes user data</p>
							</div>

							<div style="background:#1a4a2e; padding:16px; border-radius:8px; margin:12px 0;">
								<p><strong>‚úÖ Quest Complete!</strong></p>
								<p><strong>Answer:</strong> B) Checks if user meets minimum requirements</p>
								<p>üéâ You've mastered Move basics: variables, functions, and logic!</p>
								<p><strong>Reward:</strong> 0.1 APT + "Move Beginner" badge</p>
							</div>
						`
					}
				]
			},
			2: {
				title: 'üîß Struct & Functions',
				steps: [
					{
						title: 'Challenge 1: Build a User Profile',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Create a user profile system using Move structs.</p>
							
							<h4>üìù Task:</h4>
							<p>Complete the struct definition and constructor function:</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>module 0x1::user_profile {
    struct UserProfile has copy, drop, store {
        username: vector&lt;u8&gt;,
        level: u8,
        experience: u64,
        is_premium: bool,
    }
    
    public fun create_profile(
        username: vector&lt;u8&gt;
    ): UserProfile {
        UserProfile {
            username,
            level: _____,      // Start at level 1
            experience: _____, // Start with 0 XP
            is_premium: _____, // Start as false
        }
    }
}</code></pre>
							</div>

							<h4>üí° Requirements:</h4>
							<ul>
								<li>New users start at level 1</li>
								<li>New users start with 0 experience</li>
								<li>New users are not premium initially</li>
							</ul>
						`
					},
					{
						title: 'Challenge 2: Profile Functions',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Implement functions to manage user profiles.</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>// Add these functions to the user_profile module:

public fun add_experience(
    profile: &mut UserProfile, 
    xp: u64
) {
    profile.experience = profile.experience + xp;
    
    // Level up every 1000 XP
    if (profile.experience >= (profile.level as u64) * 1000) {
        profile.level = _____;  // Increase level by 1
    }
}

public fun upgrade_to_premium(profile: &mut UserProfile) {
    // TODO: Set is_premium to true
    _____
}

public fun get_user_info(profile: &UserProfile): (u8, u64, bool) {
    // TODO: Return (level, experience, is_premium)
    _____
}</code></pre>
							</div>

							<h4>üß™ Test Your Logic:</h4>
							<p>A user with 2500 XP should be at level 3!</p>
						`
					},
					{
						title: 'Challenge 3: Advanced Struct Usage',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Debug this inventory system and make it work.</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>module 0x1::inventory {
    struct Item has copy, drop {
        name: vector&lt;u8&gt;,
        rarity: u8,  // 1=common, 5=legendary
        power: u64,
    }
    
    struct Inventory has store {
        items: vector&lt;Item&gt;,
        capacity: u64,
    }
    
    public fun add_item(
        inventory: &mut Inventory,
        item: Item
    ): bool {
        if (vector::length(&inventory.items) < inventory.capacity) {
            vector::push_back(&mut inventory.items, item);
            true
        } else {
            false  // Inventory full!
        }
    }
}</code></pre>
							</div>

							<h4>‚ùì Code Analysis:</h4>
							<div style="background:#1a3a4a; padding:12px; border-radius:8px; margin:8px 0;">
								<p><strong>What happens when inventory is full?</strong></p>
								<p>A) Item is added anyway<br/>
								B) Function returns false<br/>
								C) Program crashes<br/>
								D) Item replaces oldest item</p>
							</div>

							<div style="background:#1a4a2e; padding:16px; border-radius:8px; margin:12px 0;">
								<p><strong>‚úÖ Quest Complete!</strong></p>
								<p><strong>Answer:</strong> B) Function returns false</p>
								<p>üéâ You've mastered Move structs and functions!</p>
								<p><strong>Reward:</strong> 0.2 APT + "Struct Master" badge</p>
							</div>
						`
					}
				]
			},
			3: {
				title: 'üí∞ Resource Model',
				steps: [
					{
						title: 'Challenge 1: Create a Secure Coin',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Build a secure digital coin using Move's resource model.</p>
							
							<h4>üìù Task:</h4>
							<p>Complete the coin module with proper resource abilities:</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>module 0x1::secure_coin {
    // Define a coin that can be stored but not copied or dropped
    struct Coin has _____ {  // Fill in the correct abilities
        value: u64,
    }
    
    public fun mint(amount: u64): Coin {
        Coin { value: amount }
    }
    
    public fun burn(coin: Coin): u64 {
        let Coin { value } = coin;
        value
    }
    
    public fun merge(coin1: Coin, coin2: Coin): Coin {
        let value1 = burn(coin1);
        let value2 = burn(coin2);
        mint(value1 + value2)
    }
}</code></pre>
							</div>

							<h4>üí° Hint:</h4>
							<p>Resources need <code>store</code> to be kept in structs, but should NOT have <code>copy</code> or <code>drop</code> for security!</p>
						`
					},
					{
						title: 'Challenge 2: Prevent Double Spending',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Analyze this code and identify the security issue.</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>// ‚ö†Ô∏è BUGGY CODE - Find the problem!
module 0x1::bad_coin {
    struct BadCoin has copy, drop, store {
        value: u64,
    }
    
    public fun create_money(amount: u64): BadCoin {
        BadCoin { value: amount }
    }
    
    public fun double_money(coin: BadCoin): (BadCoin, BadCoin) {
        (coin, coin)  // This creates two coins from one!
    }
}</code></pre>
							</div>

							<h4>‚ùì Security Analysis:</h4>
							<div style="background:#4a1a1a; padding:12px; border-radius:8px; margin:8px 0;">
								<p><strong>‚ö†Ô∏è What's wrong with this code?</strong></p>
								<p>A) Function names are too short<br/>
								B) Coin can be copied, enabling double spending<br/>
								C) Value should be u32 instead of u64<br/>
								D) Missing error handling</p>
							</div>

							<h4>üõ°Ô∏è The Fix:</h4>
							<p>Remove <code>copy</code> and <code>drop</code> abilities to prevent duplication!</p>
						`
					},
					{
						title: 'Challenge 3: Resource Ownership',
						content: `
							<h3>üéØ Your Mission</h3>
							<p>Implement a secure wallet system that tracks coin ownership.</p>
							
							<div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;">
								<pre><code>module 0x1::wallet {
    use 0x1::secure_coin::Coin;
    
    struct Wallet has key {
        coins: vector&lt;Coin&gt;,
        owner: address,
    }
    
    public entry fun create_wallet(account: &signer) {
        let wallet = Wallet {
            coins: vector::empty&lt;Coin&gt;(),
            owner: signer::address_of(account),
        };
        move_to(account, wallet);
    }
    
    public entry fun deposit(
        account: &signer, 
        coin: Coin
    ) acquires Wallet {
        let wallet = borrow_global_mut&lt;Wallet&gt;(
            signer::address_of(account)
        );
        vector::push_back(&mut wallet.coins, coin);
    }
}</code></pre>
							</div>

							<h4>üîç Understanding:</h4>
							<ul>
								<li><code>has key</code> - Can be stored in global storage</li>
								<li><code>move_to</code> - Moves resource to account</li>
								<li><code>acquires</code> - Declares global resource access</li>
							</ul>

							<div style="background:#1a4a2e; padding:16px; border-radius:8px; margin:12px 0;">
								<p><strong>‚úÖ Quest Complete!</strong></p>
								<p><strong>Answer:</strong> B) Coin can be copied, enabling double spending</p>
								<p>üéâ You've mastered Move's resource model and security!</p>
								<p><strong>Reward:</strong> 0.4 APT + "Security Expert" badge</p>
							</div>
						`
					}
				]
			},
			4: {
				title: 'üîÑ Control Flow',
				steps: [
					{
						title: 'Challenge 1: Conditional Logic',
						content: `<h3>üéØ Your Mission</h3><p>Build conditional logic for access control.</p><div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;"><pre><code>public fun check_access(user_level: u8, is_premium: bool): bool {
    if (user_level >= _____) {  // Fill: 10
        return true
    };
    if (is_premium) {
        return true
    };
    false
}</code></pre></div><div style="background:#1a4a2e; padding:16px; border-radius:8px; margin:12px 0;"><p><strong>‚úÖ Quest Complete!</strong></p><p>üéâ Control flow mastered!</p><p><strong>Reward:</strong> 0.12 APT + "Logic Master" badge</p></div>`
					}
				]
			},
			5: {
				title: 'üì¶ Modules',
				steps: [
					{
						title: 'Challenge 1: Module Design',
						content: `<h3>üéØ Your Mission</h3><p>Design a modular DeFi system.</p><div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;"><pre><code>module 0x1::defi_core {
    use std::signer;
    use 0x1::coin::Coin;
    
    struct Pool has key {
        token_a: Coin,
        token_b: Coin,
    }
    
    public fun create_pool(account: &signer, a: Coin, b: Coin) {
        move_to(account, Pool { token_a: a, token_b: b });
    }
}</code></pre></div><div style="background:#1a4a2e; padding:16px; border-radius:8px; margin:12px 0;"><p><strong>‚úÖ Quest Complete!</strong></p><p>üéâ Module architecture mastered!</p><p><strong>Reward:</strong> 0.25 APT + "Module Architect" badge</p></div>`
					}
				]
			},
			6: {
				title: 'üõ°Ô∏è Security',
				steps: [
					{
						title: 'Challenge 1: Security Patterns',
						content: `<h3>üéØ Your Mission</h3><p>Implement secure access control.</p><div style="background:#2a2a2a; padding:16px; border-radius:8px; margin:12px 0;"><pre><code>public entry fun secure_withdraw(
    account: &signer,
    amount: u64
) acquires Vault {
    let vault = borrow_global_mut<Vault>(@vault);
    
    // Security: Check authorization
    assert!(signer::address_of(account) == vault.admin, E_NOT_AUTHORIZED);
    
    // Security: Check balance
    assert!(vault.balance >= amount, E_INSUFFICIENT_BALANCE);
    
    vault.balance = vault.balance - amount;
}</code></pre></div><div style="background:#1a4a2e; padding:16px; border-radius:8px; margin:12px 0;"><p><strong>‚úÖ Quest Complete!</strong></p><p>üéâ Security expert achieved!</p><p><strong>Reward:</strong> 0.5 APT + "Security Auditor" badge</p></div>`
					}
				]
			}
		};

		// Quests catalog with on-chain integration
		const quests = [
			{ id:1, title:'üéØ Basic Move Syntax', diff:'Beginner', reward:'10 APT', desc:'Move basics: variables, functions, types.', completed: false, progress: 0, onChainTx: null },
			{ id:2, title:'üîß Struct & Functions', diff:'Intermediate', reward:'20 APT', desc:'Structs, public functions, and modular design.', completed: false, progress: 0, onChainTx: null },
			{ id:3, title:'üí∞ Resource Model', diff:'Advanced', reward:'40 APT', desc:'Resource safety, abilities, and ownership model.', completed: false, progress: 0, onChainTx: null },
			{ id:4, title:'üîÑ Control Flow', diff:'Beginner', reward:'12 APT', desc:'Conditionals, loops, and patterns.', completed: false, progress: 0, onChainTx: null },
			{ id:5, title:'üì¶ Modules', diff:'Intermediate', reward:'25 APT', desc:'Module design, visibility, dependencies.', completed: false, progress: 0, onChainTx: null },
			{ id:6, title:'üõ°Ô∏è Security', diff:'Advanced', reward:'50 APT', desc:'Security best practices, testing, and reviews.', completed: false, progress: 0, onChainTx: null }
		];

		// Builder profiles (now with completed, streak, badges)
		const profiles = [
			{ id:1, name:'Ne≈üe Demir', handle:'@nese', bio:'Focused on Move security & smart contract auditing.', skills:['Move','Security','Auditing','Testing'], tz:'GMT+3', avail:'Mentor: Available', completed: 35, streak: 16, badges:['Security Expert','Auditor','Top Contributor'], links:[{t:'GitHub',u:'https://github.com/'},{t:'X',u:'https://x.com/'}] },
			{ id:2, name:'Deniz Arda', handle:'@deniz', bio:'Tooling and developer experience.', skills:['Move','Tooling','DX','CLI'], tz:'GMT+1', avail:'Mentor: Busy', completed: 20, streak: 5, badges:['DX Builder','CLI Wizard'], links:[{t:'GitHub',u:'https://github.com/'},{t:'Site',u:'#'}] },
			{ id:3, name:'Efe Can', handle:'@efecan', bio:'Quests and education content.', skills:['Move','Education','Docs'], tz:'GMT+2', avail:'Mentor: Available', completed: 18, streak: 9, badges:['Educator','Quest Maker'], links:[{t:'GitHub',u:'https://github.com/'}] },
			{ id:4, name:'Dilek √ñzkan', handle:'@dilek', bio:'DeFi protocols and yield farming specialist.', skills:['DeFi','Protocols','Yield','Finance'], tz:'GMT+3', avail:'Mentor: Available', completed: 29, streak: 18, badges:['DeFi Master','Protocol Builder'], links:[{t:'GitHub',u:'https://github.com/'},{t:'LinkedIn',u:'https://linkedin.com/'}] },
			{ id:5, name:'Okan T.', handle:'@okant', bio:'Collaboration & hackathon facilitator.', skills:['Collab','Hackathons','PM'], tz:'GMT+3', avail:'Mentor: Busy', completed: 14, streak: 3, badges:['Facilitator'], links:[{t:'GitHub',u:'https://github.com/'}] },
			{ id:6, name:'Selin A.', handle:'@selina', bio:'Analytics and platform metrics.', skills:['Analytics','Metrics','Dashboards'], tz:'GMT-1', avail:'Mentor: Available', completed: 22, streak: 12, badges:['Insights Pro'], links:[{t:'GitHub',u:'https://github.com/'}] }
		];

		// Elements
		const exploreBtn = document.getElementById('exploreQuests');
		const modal = document.getElementById('questsModal');
		const closeModal = document.getElementById('closeModal');
		const grid = document.getElementById('qgrid');

		const profilesGrid = document.getElementById('profilesGrid');
		const pModal = document.getElementById('profileModal');
		const pmClose = document.getElementById('pm_close');
		const pmName = document.getElementById('pm_name');
		const pmBio = document.getElementById('pm_bio');
		const pmSkills = document.getElementById('pm_skills');
		const pmAvail = document.getElementById('pm_avail');
		const pmTz = document.getElementById('pm_tz');
		const pmLinks = document.getElementById('pm_links');
		const pmCompleted = document.getElementById('pm_completed');
		const pmStreak = document.getElementById('pm_streak');
		const pmBadges = document.getElementById('pm_badges');

		// Render profiles (3-3 grid), include quick summary
		profilesGrid.innerHTML = profiles.map(p => `
			<div class="card">
				<h3>${p.name} <span style="color:#bdbdbd; font-weight:400">${p.handle}</span></h3>
				<p>${p.bio}</p>
				<div class="chips">
					${p.skills.map(s => `<span class=\"chip\">${s}</span>`).join('')}
				</div>
				<div class="row" style="margin-top:10px; justify-content:space-between;">
					<span class="badge">Completed: ${p.completed}</span>
					<span class="badge">Streak: ${p.streak}d</span>
					<button class="btn" data-profile="${p.id}">View Profile</button>
				</div>
			</div>
		`).join('');

		profilesGrid.addEventListener('click', (e) => {
			const t = e.target;
			if (t && t instanceof Element && t.getAttribute('data-profile')) {
				const id = Number(t.getAttribute('data-profile'));
				const p = profiles.find(x => x.id === id);
				if (!p) return;
				pmName.textContent = p.name + ' ' + p.handle;
				pmBio.textContent = p.bio;
				pmSkills.innerHTML = p.skills.map(s => `<span class=\"chip\">${s}</span>`).join('');
				pmAvail.textContent = p.avail;
				pmTz.textContent = p.tz;
				pmLinks.innerHTML = p.links.map(l => `<a class=\"linkish\" href=\"${l.u}\" target=\"_blank\">${l.t}</a>`).join(' ¬∑ ');
				pmCompleted.textContent = String(p.completed);
				pmStreak.textContent = String(p.streak);
				pmBadges.innerHTML = (p.badges || []).map(b => `<span class=\"chip\">${b}</span>`).join('');
				
				// Add mentorship booking button if available
				if (p.avail.includes('Available')) {
					const bookingBtn = document.createElement('button');
					bookingBtn.className = 'btn';
					bookingBtn.textContent = 'üìÖ Book Mentorship';
					bookingBtn.style.marginTop = '12px';
					bookingBtn.onclick = () => bookMentorship(p);
					
					const existingBtn = document.querySelector('#profileModal .btn');
					if (existingBtn) existingBtn.remove();
					document.getElementById('pm_badges').parentNode.appendChild(bookingBtn);
				}
				
				pModal.style.display = 'grid';
			}
		});

		// Mentorship booking system
		function bookMentorship(mentor) {
			if (!walletConnected) {
				showNotification('Please connect your wallet first!');
				return;
			}

			const sessions = [
				'Move Basics (1 hour) - Free',
				'Smart Contract Development (2 hours) - 0.1 APT',
				'Security Audit (1 hour) - 0.2 APT',
				'Career Guidance (30 min) - Free'
			];

			const sessionList = sessions.map((s, i) => 
				`<div style="padding:8px; border:1px solid #333; border-radius:8px; margin:4px 0; cursor:pointer;" onclick="selectSession(${i}, '${s}')">${s}</div>`
			).join('');

			showNotification(`
				<div style="max-width:300px;">
					<h4>Book session with ${mentor.name}</h4>
					<p>Available time slots:</p>
					${sessionList}
				</div>
			`);
		}

		window.selectSession = function(index, session) {
			showNotification('üéâ Session booked! You will receive a calendar invite.');
			pModal.style.display = 'none';
		};

		pmClose.addEventListener('click', (e) => { e.preventDefault(); pModal.style.display='none'; });
		pModal.addEventListener('click', (e) => { if (e.target === pModal) pModal.style.display='none'; });

		// Quests modal
		exploreBtn.addEventListener('click', () => {
			grid.innerHTML = quests.map(q => `
				<div class="qcard ${q.completed ? 'completed' : ''}">
					<div class="qtop">
						<h3 style="margin:0; font-size:16px">${q.title} ${q.completed ? '‚úÖ' : ''}</h3>
						<span class="qdiff">${q.diff}</span>
					</div>
					<p class="qdesc">${q.desc}</p>
					${q.progress > 0 && !q.completed ? `
						<div class="quest-progress">
							<div class="progress-bar">
								<div class="progress-fill" style="width:${q.progress}%"></div>
							</div>
							<small>Progress: ${q.progress}%</small>
						</div>
					` : ''}
					<div class="qrow">
						<span class="qreward">Reward: ${q.reward}</span>
						${q.completed ? `
							<a href="https://explorer.aptoslabs.com/txn/${q.onChainTx}?network=testnet" target="_blank" class="btn secondary" style="font-size:12px;">View Tx</a>
						` : `
							<button class="btn" onclick="startQuest(${q.id})">${walletConnected ? 'Start Quest' : 'Connect Wallet'}</button>
						`}
					</div>
				</div>
			`).join('');
			modal.style.display = 'grid';
		});

		// Quest content modal variables
		let currentQuestId = null;
		let currentStep = 0;
		const questContentModal = document.getElementById('questContentModal');
		const questContentTitle = document.getElementById('questContentTitle');
		const questContentBody = document.getElementById('questContentBody');
		const stepIndicator = document.getElementById('stepIndicator');
		const prevStepBtn = document.getElementById('prevStep');
		const nextStepBtn = document.getElementById('nextStep');
		const closeQuestContent = document.getElementById('closeQuestContent');

		// Start quest function
		window.startQuest = async function(questId) {
			if (!walletConnected) {
				await connectWallet();
				return;
			}

			// Open quest content
			const questContent = questContents[questId];
			if (questContent) {
				currentQuestId = questId;
				currentStep = 0;
				showQuestContent();
				modal.style.display = 'none'; // Close quest list modal
			} else {
				// Fallback for quests without content
				const quest = quests.find(q => q.id === questId);
				if (quest && !quest.completed) {
					showNotification('üéØ Starting quest: ' + quest.title);
					simulateQuestProgress(questId);
				}
			}
		};

		function showQuestContent() {
			const questContent = questContents[currentQuestId];
			if (!questContent) return;

			questContentTitle.textContent = questContent.title;
			questContentBody.innerHTML = questContent.steps[currentStep].content;
			stepIndicator.textContent = `Step ${currentStep + 1} of ${questContent.steps.length}`;
			
			// Update button states
			prevStepBtn.style.display = currentStep > 0 ? 'block' : 'none';
			nextStepBtn.textContent = currentStep === questContent.steps.length - 1 ? 'Complete Quest' : 'Next ‚Üí';
			
			questContentModal.style.display = 'grid';
		}

		function simulateQuestProgress(questId) {
			const quest = quests.find(q => q.id === questId);
			let progress = 0;
			const progressInterval = setInterval(() => {
				progress += 20;
				quest.progress = progress;
				
				if (progress >= 100) {
					clearInterval(progressInterval);
					completeQuest(questId);
				}
				
				// Update modal if open
				if (modal.style.display === 'grid') {
					exploreBtn.click();
				}
			}, 1000);
		}

		// Quest content navigation
		prevStepBtn.addEventListener('click', () => {
			if (currentStep > 0) {
				currentStep--;
				showQuestContent();
			}
		});

		nextStepBtn.addEventListener('click', () => {
			const questContent = questContents[currentQuestId];
			if (currentStep < questContent.steps.length - 1) {
				currentStep++;
				showQuestContent();
			} else {
				// Complete quest
				questContentModal.style.display = 'none';
				showNotification('üéØ Completing quest: ' + questContent.title);
				simulateQuestProgress(currentQuestId);
			}
		});

		closeQuestContent.addEventListener('click', (e) => {
			e.preventDefault();
			questContentModal.style.display = 'none';
		});

		questContentModal.addEventListener('click', (e) => {
			if (e.target === questContentModal) {
				questContentModal.style.display = 'none';
			}
		});

		closeModal.addEventListener('click', (e) => { e.preventDefault(); modal.style.display='none'; });
		modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display='none'; });

		// Wallet event listeners
		document.getElementById('connectWallet').addEventListener('click', connectWallet);
		document.getElementById('disconnectWallet').addEventListener('click', disconnectWallet);

		document.getElementById('viewStats').addEventListener('click', () => {
			showNotification('üìä Analytics dashboard is live! Real-time data from Aptos testnet.');
			// Scroll to dashboard
			document.querySelector('.dashboard-grid').scrollIntoView({ behavior: 'smooth' });
		});

		// Collaboration and mentorship functions
		function initializeCollaborationButtons() {
			const findMentorBtn = document.getElementById('findMentorBtn');
			const joinPairBtn = document.getElementById('joinPairBtn');
			const viewHackathonsBtn = document.getElementById('viewHackathonsBtn');
			const viewSponsorPoolsBtn = document.getElementById('viewSponsorPools');
			const leaderboardBtn = document.getElementById('leaderboardBtn');
			const verifyRewardsBtn = document.getElementById('verifyRewards');

			if (findMentorBtn) {
				findMentorBtn.addEventListener('click', () => {
					showNotification(`
						<div style="max-width:400px; text-align:center;">
							<h4>üë• Available Mentors</h4>
							<div style="padding:12px; border:1px solid #2a5a2a; border-radius:8px; margin:8px 0; background:#0f1f0f;">
								<strong>üîê Ne≈üe Demir</strong><br/>
								<small>Security & Smart Contract Auditing</small><br/>
								<span class="chip" style="margin-top:4px;">Available Now</span><br/>
								<button class="btn" style="margin-top:8px;" onclick="bookMentorDirect('nese')">Book Session</button>
							</div>
							<div style="padding:12px; border:1px solid #2a5a2a; border-radius:8px; margin:8px 0; background:#0f1f0f;">
								<strong>üí∞ Dilek √ñzkan</strong><br/>
								<small>DeFi Protocols & Yield Farming</small><br/>
								<span class="chip" style="margin-top:4px;">Available Now</span><br/>
								<button class="btn" style="margin-top:8px;" onclick="bookMentorDirect('dilek')">Book Session</button>
							</div>
							<div style="padding:12px; border:1px solid #2a5a2a; border-radius:8px; margin:8px 0; background:#0f1f0f;">
								<strong>üìö Efe Can</strong><br/>
								<small>Education & Content Creation</small><br/>
								<span class="chip" style="margin-top:4px;">Available Now</span><br/>
								<button class="btn" style="margin-top:8px;" onclick="bookMentorDirect('efecan')">Book Session</button>
							</div>
						</div>
					`);
				});
			}

			if (joinPairBtn) {
				joinPairBtn.addEventListener('click', () => {
					if (!walletConnected) {
						showNotification('Please connect your wallet to join pair programming sessions!');
						return;
					}
					
					const sessions = [
						'Quest 1: Basic Move Syntax - Starting in 15 min',
						'Quest 3: Resource Model - Starting in 45 min',
						'Custom DeFi Project - Starting now'
					];
					
					showNotification(`
						<div style="max-width:300px;">
							<h4>ü§ù Active Pair Programming Sessions</h4>
							${sessions.map((s, i) => `<div style="padding:8px; border:1px solid #333; border-radius:8px; margin:4px 0; cursor:pointer;" onclick="joinPairSession(${i})">${s}</div>`).join('')}
						</div>
					`);
				});
			}

			if (viewHackathonsBtn) {
				viewHackathonsBtn.addEventListener('click', () => {
					showNotification(`
						<div style="max-width:350px;">
							<h4>üèÜ Upcoming Mini-Hackathons</h4>
							<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0;">
								<strong>Move DeFi Challenge</strong><br/>
								<small>Jan 15-17, 2025 ‚Ä¢ Prize: 50 APT</small><br/>
								<button class="btn" style="margin-top:8px;" onclick="registerHackathon('defi')">Register</button>
							</div>
							<div style="padding:12px; border:1px solid #333; border-radius:8px; margin:8px 0;">
								<strong>NFT Innovation Sprint</strong><br/>
								<small>Jan 22-24, 2025 ‚Ä¢ Prize: 30 APT</small><br/>
								<button class="btn" style="margin-top:8px;" onclick="registerHackathon('nft')">Register</button>
							</div>
						</div>
					`);
				});
			}

			// Rewards and sponsor functions
			if (viewSponsorPoolsBtn) {
				viewSponsorPoolsBtn.addEventListener('click', () => {
					showNotification(`
						<div style="max-width:500px; text-align:center;">
							<h4>üí∞ Active Sponsor Pools</h4>
							<div style="padding:16px; border:1px solid #2a5a2a; border-radius:8px; margin:12px 0; background:#0f1f0f;">
								<strong>üè¶ Aptos Foundation Pool</strong><br/>
								<small>Focus: Core Move development and education</small><br/>
								<div style="margin:8px 0;">
									<span class="chip">Pool: 1000 APT</span>
									<span class="chip">127 Participants</span>
								</div>
								<div style="background:#1a1a1a; height:6px; border-radius:3px; margin:8px 0;">
									<div style="background:#82ffa1; height:100%; width:65%; border-radius:3px;"></div>
								</div>
								<small>65% distributed ‚Ä¢ Ends Feb 28</small><br/>
								<button class="btn" style="margin-top:8px;" onclick="joinSponsorPool('aptos-foundation')">Join Pool</button>
							</div>
							<div style="padding:16px; border:1px solid #2a5a2a; border-radius:8px; margin:12px 0; background:#0f1f0f;">
								<strong>üîä Decibel Pool</strong><br/>
								<small>Focus: Infrastructure and developer tooling</small><br/>
								<div style="margin:8px 0;">
									<span class="chip">Pool: 750 APT</span>
									<span class="chip">92 Participants</span>
								</div>
								<div style="background:#1a1a1a; height:6px; border-radius:3px; margin:8px 0;">
									<div style="background:#82ffa1; height:100%; width:45%; border-radius:3px;"></div>
								</div>
								<small>45% distributed ‚Ä¢ Ends Feb 15</small><br/>
								<button class="btn" style="margin-top:8px;" onclick="joinSponsorPool('decibel')">Join Pool</button>
							</div>
							<div style="padding:16px; border:1px solid #2a5a2a; border-radius:8px; margin:12px 0; background:#0f1f0f;">
								<strong>‚ö° Shelby Protocol Pool</strong><br/>
								<small>Focus: Cross-chain and interoperability</small><br/>
								<div style="margin:8px 0;">
									<span class="chip">Pool: 400 APT</span>
									<span class="chip">67 Participants</span>
								</div>
								<div style="background:#1a1a1a; height:6px; border-radius:3px; margin:8px 0;">
									<div style="background:#82ffa1; height:100%; width:30%; border-radius:3px;"></div>
								</div>
								<small>30% distributed ‚Ä¢ Ends Mar 10</small><br/>
								<button class="btn" style="margin-top:8px;" onclick="joinSponsorPool('shelby-protocol')">Join Pool</button>
							</div>
						</div>
					`);
				});
			}

			if (leaderboardBtn) {
				leaderboardBtn.addEventListener('click', () => {
					showNotification(`
						<div style="max-width:400px;">
							<h4>üèÜ Current Leaderboard</h4>
							<div style="padding:8px; border-bottom:1px solid #333;">
								<strong>1. @nese</strong> - 35 quests ‚Ä¢ 1.4 APT earned
							</div>
							<div style="padding:8px; border-bottom:1px solid #333;">
								<strong>2. @dilek</strong> - 29 quests ‚Ä¢ 1.1 APT earned
							</div>
							<div style="padding:8px; border-bottom:1px solid #333;">
								<strong>3. @selina</strong> - 22 quests ‚Ä¢ 0.7 APT earned
							</div>
							<div style="padding:8px; border-bottom:1px solid #333;">
								<strong>4. @deniz</strong> - 20 quests ‚Ä¢ 0.6 APT earned
							</div>
							<div style="padding:8px;">
								<strong>5. @efecan</strong> - 18 quests ‚Ä¢ 0.5 APT earned
							</div>
						</div>
					`);
				});
			}

			if (verifyRewardsBtn) {
				verifyRewardsBtn.addEventListener('click', () => {
					if (!walletConnected) {
						showNotification('Please connect your wallet to verify rewards!');
						return;
					}
					
					showNotification(`
						<div style="max-width:350px;">
							<h4>‚úÖ Your Verified Rewards</h4>
							<div style="padding:8px; border:1px solid #2a5a2a; border-radius:8px; margin:4px 0; background:#0f1f0f;">
								<strong>Quest Completions:</strong> 0<br/>
								<strong>Total Earned:</strong> 0 APT<br/>
								<strong>On-Chain Transactions:</strong> 0
							</div>
							<p><small>Complete quests to start earning rewards!</small></p>
						</div>
					`);
				});
			}
		}


		window.joinPairSession = function(index) {
			showNotification(`
				<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
					<div>
						<h4 style="margin:0 0 8px 0;">üéâ Success!</h4>
						<p style="margin:0;">Joined pair programming session! Discord invite sent.</p>
					</div>
				</div>
			`);
		};

		window.joinCollaboration = function(projectId) {
			if (!walletConnected) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">üîó Wallet Required</h4>
							<p style="margin:0;">Please connect your wallet to join collaborations!</p>
						</div>
					</div>
				`);
				return;
			}
			showNotification(`
				<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
					<div>
						<h4 style="margin:0 0 8px 0;">‚úÖ Application Sent!</h4>
						<p style="margin:0;">Application sent for ${projectId}! Team lead will contact you.</p>
					</div>
				</div>
			`);
		};

		window.registerHackathon = function(hackathonId) {
			if (!walletConnected) {
				showNotification('Please connect your wallet to register!');
				return;
			}
			showNotification('üéâ Registered for hackathon! Details will be sent via email.');
		};


		window.joinSponsorPool = function(poolId) {
			if (!walletConnected) {
				showNotification('Please connect your wallet to join sponsor pools!');
				return;
			}
			showNotification(`‚úÖ Joined ${poolId} sponsor pool! Start completing quests to earn rewards.`);
		};

		window.bookMentorDirect = function(mentorHandle) {
			if (!walletConnected) {
				showNotification('Please connect your wallet to book mentorship sessions!');
				return;
			}
			
			const mentorData = {
				'nese': { name: 'Ne≈üe Demir', specialty: 'Security & Auditing' },
				'dilek': { name: 'Dilek √ñzkan', specialty: 'DeFi Protocols' },
				'efecan': { name: 'Efe Can', specialty: 'Education & Content' }
			};
			
			const mentor = mentorData[mentorHandle];
			if (mentor) {
				showNotification(`
					<div style="max-width:350px; text-align:center;">
						<h4>üìÖ Book Session with ${mentor.name}</h4>
						<p><strong>Specialty:</strong> ${mentor.specialty}</p>
						<div style="margin:12px 0;">
							<div style="padding:8px; border:1px solid #333; border-radius:8px; margin:4px 0; cursor:pointer;" onclick="selectMentorSession('intro')">
								<strong>Introduction Session</strong><br/>
								<small>30 min ‚Ä¢ Free</small>
							</div>
							<div style="padding:8px; border:1px solid #333; border-radius:8px; margin:4px 0; cursor:pointer;" onclick="selectMentorSession('deep-dive')">
								<strong>Deep Dive Session</strong><br/>
								<small>1 hour ‚Ä¢ 0.1 APT</small>
							</div>
							<div style="padding:8px; border:1px solid #333; border-radius:8px; margin:4px 0; cursor:pointer;" onclick="selectMentorSession('project-review')">
								<strong>Project Review</strong><br/>
								<small>45 min ‚Ä¢ 0.15 APT</small>
							</div>
						</div>
					</div>
				`);
			}
		};

		window.selectMentorSession = function(sessionType) {
			showNotification(`
				<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
					<div>
						<h4 style="margin:0 0 8px 0;">üéâ Session Booked!</h4>
						<p style="margin:0;">Mentorship session booked! Calendar invite will be sent to your email.</p>
					</div>
				</div>
			`);
		};

		// Highlight card scroll functions
		window.scrollToQuests = function() {
			exploreBtn.click(); // Open quest modal directly
		};

		window.scrollToMentorship = function() {
			const mentorshipSection = Array.from(document.querySelectorAll('h2')).find(h => 
				h.textContent.includes('Mentorship & Collaboration')
			);
			if (mentorshipSection) {
				mentorshipSection.scrollIntoView({ behavior: 'smooth' });
			}
		};

		window.scrollToCollaboration = function() {
			const collaborationSection = Array.from(document.querySelectorAll('h3')).find(h => 
				h.textContent.includes('üî• Active Collaborations')
			);
			if (collaborationSection) {
				collaborationSection.scrollIntoView({ behavior: 'smooth' });
			} else {
				scrollToMentorship(); // Fallback to mentorship section
			}
		};

		window.scrollToRewards = function() {
			const rewardsSection = Array.from(document.querySelectorAll('h2')).find(h => 
				h.textContent.includes('Rewards & Sponsors')
			);
			if (rewardsSection) {
				rewardsSection.scrollIntoView({ behavior: 'smooth' });
			}
		};

		window.scrollToAnalytics = function() {
			const analyticsSection = Array.from(document.querySelectorAll('h2')).find(h => 
				h.textContent.includes('Live Analytics Dashboard')
			);
			if (analyticsSection) {
				analyticsSection.scrollIntoView({ behavior: 'smooth' });
			}
		};

		window.scrollToProfiles = function() {
			const profilesSection = Array.from(document.querySelectorAll('h2')).find(h => 
				h.textContent.includes('Builder Profiles')
			);
			if (profilesSection) {
				profilesSection.scrollIntoView({ behavior: 'smooth' });
			}
		};

		// Social sharing functions (simple, non-intrusive)
		window.shareAchievement = function(questTitle, txHash) {
			const shareText = `üéâ Just completed "${questTitle}" on Move Builders Hub! Learning Move programming on-chain. 

üîó Join me: https://movebuildershub.xyz
‚õìÔ∏è Verify: https://explorer.aptoslabs.com/txn/${txHash}?network=testnet

#Move #Aptos #Web3Education #Blockchain`;

			if (navigator.share) {
				// Native mobile sharing
				navigator.share({
					title: 'Move Builders Hub Achievement',
					text: shareText,
					url: 'https://movebuildershub.xyz'
				});
			} else {
				// Fallback: Copy to clipboard + social links
				navigator.clipboard.writeText(shareText).then(() => {
					showNotification(`
						<div style="text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;">
							<div>
								<h4 style="margin:0 0 12px 0;">üìã Copied to Clipboard!</h4>
								<p style="margin:0 0 12px 0;">Share your achievement:</p>
								<div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
									<button class="btn secondary" onclick="window.open('https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}', '_blank')" style="font-size:12px;">Share on X</button>
									<button class="btn secondary" onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url=https://movebuildershub.xyz', '_blank')" style="font-size:12px;">Share on LinkedIn</button>
								</div>
							</div>
						</div>
					`);
				});
			}
		};

		window.viewNextQuest = function(currentQuestId) {
			const nextQuest = quests.find(q => q.id === currentQuestId + 1 && !q.completed);
			if (nextQuest) {
				startQuest(nextQuest.id);
			} else {
				exploreBtn.click(); // Open quest modal to see all
			}
		};

		// Profile creation functions
		window.openCreateProfile = function() {
			document.getElementById('createProfileModal').style.display = 'grid';
			// Reset form
			document.getElementById('usernameInput').value = '';
			document.getElementById('bioInput').value = '';
			document.getElementById('experienceSelect').value = 'beginner';
			
			// Reset avatar selection
			document.querySelectorAll('.avatar-option').forEach(option => {
				option.classList.remove('selected');
			});
			document.querySelector(`[data-avatar="${selectedAvatar}"]`).classList.add('selected');
			
			// Reset skills
			document.querySelectorAll('.skill-checkbox input').forEach(checkbox => {
				checkbox.checked = false;
			});
		};

		window.selectAvatar = function(avatar) {
			selectedAvatar = avatar;
			document.querySelectorAll('.avatar-option').forEach(option => {
				option.classList.remove('selected');
			});
			document.querySelector(`[data-avatar="${avatar}"]`).classList.add('selected');
		};

		window.closeCreateProfile = function() {
			document.getElementById('createProfileModal').style.display = 'none';
		};

		// Security functions
		function sanitizeInput(input) {
			return input
				.replace(/[<>]/g, '') // Remove < > to prevent XSS
				.replace(/javascript:/gi, '') // Remove javascript: protocol
				.replace(/on\w+=/gi, '') // Remove event handlers
				.trim();
		}

		function validateEmail(email) {
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			return emailRegex.test(email);
		}

		function validateUsername(username) {
			// Only alphanumeric, underscore, dash, 3-20 characters
			const usernameRegex = /^[a-zA-Z0-9_-]{3,20}$/;
			return usernameRegex.test(username);
		}

		window.saveProfile = function() {
			const rawUsername = document.getElementById('usernameInput').value.trim();
			const rawBio = document.getElementById('bioInput').value.trim();
			const rawEmail = document.getElementById('emailInput').value.trim();
			const experience = document.getElementById('experienceSelect').value;

			// Sanitize inputs
			const username = sanitizeInput(rawUsername);
			const bio = sanitizeInput(rawBio);
			const email = sanitizeInput(rawEmail);
			
			// Get selected skills
			const selectedSkills = Array.from(document.querySelectorAll('.skill-checkbox input:checked'))
				.map(checkbox => checkbox.value);

			// Enhanced validation
			if (!username) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ö†Ô∏è Username Required</h4>
							<p style="margin:0;">Please enter a username to continue.</p>
						</div>
					</div>
				`);
				return;
			}

			if (!validateUsername(username)) {
				showNotification(`
					<div style="text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ö†Ô∏è Invalid Username</h4>
							<p style="margin:0;">Username must be 3-20 characters.</p>
							<p style="margin:4px 0 0 0;"><small>Only letters, numbers, underscore, and dash allowed.</small></p>
						</div>
					</div>
				`);
				return;
			}

			if (!email || !validateEmail(email)) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ö†Ô∏è Valid Email Required</h4>
							<p style="margin:0;">Please enter a valid email address (example@domain.com).</p>
						</div>
					</div>
				`);
				return;
			}

			if (selectedSkills.length === 0) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ö†Ô∏è Skills Required</h4>
							<p style="margin:0;">Please select at least one skill or interest.</p>
						</div>
					</div>
				`);
				return;
			}

			// Rate limiting check for profile updates
			const rateCheck = checkRateLimit('profileUpdate');
			if (!rateCheck.allowed) {
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚è±Ô∏è Please Wait</h4>
							<p style="margin:0;">Profile updates limited. Try again in ${rateCheck.remainingTime} seconds.</p>
						</div>
					</div>
				`);
				return;
			}

			// Show loading state
			const saveBtn = document.querySelector('#createProfileModal .btn:not(.secondary)');
			const originalText = saveBtn.textContent;
			saveBtn.classList.add('loading');
			saveBtn.textContent = 'Creating Profile...';
			saveBtn.disabled = true;

			try {
				// Show processing notification
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<div class="spinner"></div>
							<h4 style="margin:0 0 8px 0;">üîÑ Creating Profile</h4>
							<p style="margin:0;">Setting up your builder profile...</p>
						</div>
					</div>
				`);

				// Simulate API delay
				await new Promise(resolve => setTimeout(resolve, 1500));

				// Create user profile
				userProfile = {
					avatar: selectedAvatar,
					username: username,
					bio: bio || 'Move developer building on Aptos',
					email: email, // Private field
					skills: selectedSkills,
					experience: experience,
					walletAddress: walletAddress,
					createdAt: new Date().toISOString(),
					questsCompleted: 0,
					streak: 0,
					badges: ['New Builder']
				};

				// Save to localStorage (in real app, this would go to backend)
				localStorage.setItem(`profile_${walletAddress}`, JSON.stringify(userProfile));

				// Track profile creation
				trackEvent('profile_created', {
					username: username,
					skills: selectedSkills,
					experience: experience,
					hasEmail: !!email
				});

				// Update UI
				updateWalletUI();
				closeCreateProfile();

				showNotification(`
					<div style="text-align:center; min-height:80px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">üéâ Profile Created!</h4>
							<p style="margin:0;">Welcome to Move Builders Hub, ${username}!</p>
							<p style="margin:8px 0 0 0;"><small>Your profile is now live and ready to earn rewards.</small></p>
						</div>
					</div>
				`);

			} catch (error) {
				console.error('Profile creation failed:', error);
				showNotification(`
					<div style="text-align:center; min-height:60px; display:flex; align-items:center; justify-content:center;">
						<div>
							<h4 style="margin:0 0 8px 0;">‚ùå Profile Creation Failed</h4>
							<p style="margin:0;">Please try again or contact support.</p>
						</div>
					</div>
				`);
			} finally {
				// Reset button state
				saveBtn.classList.remove('loading');
				saveBtn.textContent = originalText;
				saveBtn.disabled = false;
			}
		};

		// Load user profile on wallet connect
		async function loadUserProfile() {
			if (walletAddress) {
				const savedProfile = localStorage.getItem(`profile_${walletAddress}`);
				if (savedProfile) {
					userProfile = JSON.parse(savedProfile);
				}
			}
		};

		// Simple analytics tracking (privacy-friendly)
		function trackEvent(eventName, properties = {}) {
			const event = {
				name: eventName,
				properties: {
					...properties,
					timestamp: new Date().toISOString(),
					userAgent: navigator.userAgent.includes('Mobile') ? 'mobile' : 'desktop',
					walletConnected: walletConnected
				}
			};
			
			// Store locally (in real app, send to analytics service)
			const events = JSON.parse(localStorage.getItem('analytics_events') || '[]');
			events.push(event);
			
			// Keep only last 100 events
			if (events.length > 100) events.shift();
			localStorage.setItem('analytics_events', JSON.stringify(events));
			
			console.log('üìä Event tracked:', eventName, properties);
		}

		// Initialize app
		async function initApp() {
			// Track page load
			trackEvent('page_load', { url: window.location.href });
			
			// Check for referral
			checkReferral();
			
			await checkWalletConnection();
			updateDashboard();
			updateQuestChart();
			
			// Initialize collaboration buttons
			initializeCollaborationButtons();
			
			// Update stats every 30 seconds
			setInterval(() => {
				updateActivityStats();
			}, 30000);
		}

		// Start the app
		initApp();
	})();
	</script>
</body>
</html>
